namespace = lv_scenario_cob

## Events 
## Durrandon - 0101-0199
## Targaryen - 0200-0299
## Hoare = 0300-0399
## Lannister - 0400-0499
## Varezys - 0500-0599
### Varezys New Valyria - 510-
## Justman - 0600-0699

lv_scenario_cob.0001 = { #Arrec Durrandon
	type = character_event
	title = lv_scenario_cob.0001.t
	desc = lv_scenario_cob.0001.desc

	override_background = {
		reference = agot_storms_end
	}
	theme = realm
	left_portrait = {
		character = root
		animation = marshal
	}
	lower_right_portrait = character:Hoare_25
	lower_left_portrait = character:Justman_cob_2

	immediate = {
		character:Hoare_25 = {
			save_scope_as = qhorwyn
		}
		character:Justman_cob_2 = {
			save_scope_as = lucifer_cob
		}
		character:Durrandon_70 = {
			save_scope_as = arlan
		}
		character:Justman_1 = {
			save_scope_as = benedict
		}
		character:Justman_12 = {
			save_scope_as = lucifer
		}
	}

	option = {
		name = lv_scenario_cob.0001.a
		add_prestige = 100
		stress_impact = {
			base = medium_stress_impact_gain
		}
	}
}

lv_scenario_cob.0002 = { #Aenar Targaryen
	type = character_event
	title = lv_scenario_cob.0002.t
	desc = lv_scenario_cob.0002.desc

	override_background = {
		reference = agot_dragonstone_throneroom
	}
	theme = war
	left_portrait = {
		character = root
		animation = personality_bold
	}
	right_portrait = {
		character = character:Targaryen_15
		animation = personality_content
	}
	immediate = {
		character:Targaryen_15 = {
			save_scope_as = dreamer
		}
	}
	option = {
		name = lv_scenario_cob.0002.a
		add_prestige = 100
	}
}

lv_scenario_cob.0003 = { #Qhorwyn Hoare
	type = character_event
	title = lv_scenario_cob.0003.t
	desc = lv_scenario_cob.0003.desc

	override_background = {
		reference = agot_pyke
	}
	theme = intrigue
	left_portrait = {
		character = root
	}
	lower_center_portrait = character:Hoare_27
	lower_right_portrait = character:Hoare_28

	immediate = {
		character:Hoare_27 = {
			save_scope_as = harlan
		}
		character:Hoare_28 = {
			save_scope_as = harwyn
		}
	}

	option = {
		name = lv_scenario_cob.0003.a
		add_prestige = 100
	}
}
lv_scenario_cob.0004 = { #Tommen II Lannister
	type = character_event
	title = lv_scenario_cob.0004.t
	desc = lv_scenario_cob.0004.desc

	override_background = {
		reference = agot_casterly_rock
	}
	theme = realm
	left_portrait = {
		character = root
		animation = marshal
	}

	option = {
		name = lv_scenario_cob.0004.a
		add_prestige = 100
	}
}

lv_scenario_cob.0005 = { #Aurion Varezys
	type = character_event
	title = lv_scenario_cob.0005.t
	desc = lv_scenario_cob.0005.desc

	override_background = {
		reference = agot_dragon_forest_clearing
	}

	theme = landless_adventurer

	override_effect_2d = {
		reference = smoke
	}

	left_portrait = {
		character = root
		animation = marshal
	}

	right_portrait = {
		character = var:current_dragon
		animation = dragon_main
		camera = camera_dragon_event_standing

		#Add this so dragon fits within event window
		outfit_tags = { linear_camera_zoom }
	}

    # To Valyria
	option = {
		name = lv_scenario_cob.0005.a
		custom_tooltip = lv_scenario_cob.0005.a_tt
		add_prestige = 100
		domicile = {
			if = {
				limit = { provisions < max_provisions }
				change_provisions = {
					value = 13000
				}
			}
		}	
		character:Varezys_1 = {
			#Aurion needs his host
			spawn_army = {
				levies = 30000
				location = character:Varezys_1.location
				name = aurion_qohor_army
			}
			cv_create_artifact_vs_stormbringer_effect = { OWNER = root }	
			add_character_modifier = laamp_provisions_forgiveness_travel_modifier
		}	
		start_travel_plan = {
			destination = province:8692
			on_start_on_action = on_travel_relocation_start
			on_arrival_on_action = on_travel_relocation_end
			on_arrival_event = lv_scenario_cob.0500
			on_arrival_destinations = last
			return_trip = no # One way
			travel_with_domicile = yes
		}
	}
}

lv_scenario_cob.0006 = { #Lucifer Justman
	type = character_event
	title = lv_scenario_cob.0006.t
	desc = lv_scenario_cob.0006.desc

	override_background = {
		reference = throne_room
	}
	theme = landless_adventurer
	left_portrait = root
	lower_left_portrait = character:Justman_1
	lower_right_portrait = character:Justman_12

	immediate = {
		play_music_cue = mood_the_hedge_knight
		character:Justman_1 = {
			save_scope_as = benedict
		}
		character:Justman_12 = {
			save_scope_as = lucifer
		}
		character:Durrandon_70 = {
			save_scope_as = arlan
		}
	}

    # To Highgarden
	option = {
		name = lv_scenario_cob.0006.a
		custom_tooltip = lv_scenario_cob.0006.a_tt
		add_prestige = 100
		domicile = {
			if = {
				limit = { provisions < max_provisions }
				change_provisions = {
					value = 1000
				}
			}
		}		
		title:e_the_reach.holder.capital_province = {
			save_scope_as = relocation_destination_reach
		}
		start_travel_plan = {
			destination = scope:relocation_destination_reach
			on_start_on_action = on_travel_relocation_start
			on_arrival_on_action = on_travel_relocation_end
			on_arrival_destinations = last
			return_trip = no # One way
			travel_with_domicile = yes
		}
	}
    # To Casterly Rock
	option = {
		name = lv_scenario_cob.0006.b
		custom_tooltip = lv_scenario_cob.0006.b_tt
		add_prestige = 100
		domicile = {
			if = {
				limit = { provisions < max_provisions }
				change_provisions = {
					value = 1000
				}
			}
		}		
		title:e_the_westerlands.holder.capital_province = {
			save_scope_as = relocation_destination_rock
		}
		start_travel_plan = {
			destination = scope:relocation_destination_rock
			on_start_on_action = on_travel_relocation_start
			on_arrival_on_action = on_travel_relocation_end
			on_arrival_destinations = last
			return_trip = no # One way
			travel_with_domicile = yes
		}
	}
    # To The Eyrie
	option = {
		name = lv_scenario_cob.0006.c
		custom_tooltip = lv_scenario_cob.0006.c_tt
		add_prestige = 100
		domicile = {
			if = {
				limit = { provisions < max_provisions }
				change_provisions = {
					value = 1000
				}
			}
		}		
		title:e_the_vale.holder.capital_province = {
			save_scope_as = relocation_destination_eyrie
		}
		start_travel_plan = {
			destination = scope:relocation_destination_eyrie
			on_start_on_action = on_travel_relocation_start
			on_arrival_on_action = on_travel_relocation_end
			on_arrival_destinations = last
			return_trip = no # One way
			travel_with_domicile = yes
		}
	}
    # I will decide my own path
	option = {
		name = lv_scenario_cob.0006.d
		add_prestige = 100
		domicile = {
			if = {
				limit = { provisions < max_provisions }
				change_provisions = {
					value = 1000
				}
			}
		}
	}
}

### Aurion New Valyria Chain
lv_scenario_cob.0500 = { #Aurion Varezys arrives in Ny Sar
	type = character_event
	title = lv_scenario_cob.0500.t
	desc = lv_scenario_cob.0500.desc

	override_background = {
		reference = AGOT_ruins_inside
	}

	theme = landless_adventurer

	left_portrait = {
		character = root
		animation = personality_zealous
	}
	
	lower_right_portrait = character:Nymeros_1

	immediate = {
		character:Nymeros_1 = {
			save_scope_as = Nymeria
		}
	}

	option = {
		name = lv_scenario_cob.0500.a
		custom_tooltip = lv_scenario_cob.0500.a_tt
		add_prestige = 100
		domicile = {
			if = {
				limit = { provisions < max_provisions }
				change_provisions = {
					value = 13000
				}
			}
		}	
		add_character_modifier = laamp_provisions_forgiveness_travel_modifier
		start_travel_plan = {
			destination = province:8860
			on_start_on_action = on_travel_relocation_start
			on_arrival_on_action = on_travel_relocation_end
			on_arrival_event = lv_scenario_cob.0501
			on_arrival_destinations = last
			return_trip = no # One way
			travel_with_domicile = yes
		}
	}
}
lv_scenario_cob.0501 = { #Aurion Varezys decides his path
	type = character_event
	title = lv_scenario_cob.0501.t
	desc = lv_scenario_cob.0501.desc

	override_background = {
		reference = agot_dragon_forest_clearing
	}

	theme = landless_adventurer

	left_portrait = {
		character = root
		animation = thinking
	}

	right_portrait = {
		character = var:current_dragon
		animation = dragon_main
		camera = camera_dragon_event_standing

		#Add this so dragon fits within event window
		outfit_tags = { linear_camera_zoom }
	}

	immediate = {
	}

	option = { #Aurion decides his path
		name = lv_scenario_cob.0501.a
		custom_tooltip = lv_scenario_cob.0501.a_tt
		add_prestige = 100
		domicile = {
			if = {
				limit = { provisions < max_provisions }
				change_provisions = {
					value = 13000
				}
			}
		}	
		add_character_modifier = laamp_provisions_forgiveness_travel_modifier
		start_travel_plan = {
			destination = province:8194
			on_start_on_action = on_travel_relocation_start
			on_arrival_on_action = on_travel_relocation_end
			on_arrival_event = lv_scenario_cob.0502
			on_arrival_destinations = last
			return_trip = no # One way
			travel_with_domicile = yes
		}
	}
	# Declare a New Valyria
	option = {
		name = lv_scenario_cob.0005.b
		start_war = {
			casus_belli = aurion_new_valyria
			target = title:k_volantis.holder
			claimant = root
			target_title = title:k_volantis
		}
	}
}

lv_scenario_cob.0502 = { #Aurion Varezys arrives in Volantis
	type = character_event
	title = lv_scenario_cob.0502.t
	desc = lv_scenario_cob.0502.desc

	override_background = {
		reference = AGOT_ocean_fp3_docks
	}

	theme = landless_adventurer

	left_portrait = {
		character = root
		animation = toast_goblet
	}

	immediate = {
	}

	option = {
		name = lv_scenario_cob.0502.a
		custom_tooltip = lv_scenario_cob.0502.a_tt
		add_prestige = 100
		domicile = {
			if = {
				limit = { provisions < max_provisions }
				change_provisions = {
					value = 13000
				}
			}
		}	
		add_character_modifier = laamp_provisions_forgiveness_travel_modifier
		start_travel_plan = {
			destination = province:8380
			on_start_on_action = on_travel_relocation_start
			on_arrival_on_action = on_travel_relocation_end
			on_arrival_event = lv_scenario_cob.0503
			on_arrival_destinations = last
			return_trip = no # One way
			travel_with_domicile = yes
		}
	}
}

lv_scenario_cob.0503 = { #Aurion Varezys arrives in Little Valyria
	type = character_event
	title = lv_scenario_cob.0503.t
	desc = lv_scenario_cob.0503.desc

	override_background = {
		reference = agot_taiga_bog
	}

	theme = landless_adventurer

	override_effect_2d = {
		reference = smoke
	}

	left_portrait = {
		character = root
		animation = grief
	}

	immediate = {
	}

	option = {
		name = lv_scenario_cob.0503.a
		custom_tooltip = lv_scenario_cob.0503.a_tt
		add_prestige = 100
		domicile = {
			if = {
				limit = { provisions < max_provisions }
				change_provisions = {
					value = 13000
				}
			}
		}	
		add_character_modifier = laamp_provisions_forgiveness_travel_modifier
		start_travel_plan = {
			destination = province:8983
			on_start_on_action = on_travel_relocation_start
			on_arrival_on_action = on_travel_relocation_end
			on_arrival_destinations = last
			return_trip = no # One way
			travel_with_domicile = yes
		}
	}
}

### Varezys New Valyria arc
lv_scenario_cob.0510 = { #Aurion Varezys arrives in Volantis
	type = character_event
	title = lv_scenario_cob.0510.t
	desc = lv_scenario_cob.0510.desc

	override_background = {
		reference = agot_pk_high_crownlands
	}

	theme = realm

	left_portrait = {
		character = root
		animation = war_over_win
	}

	immediate = {
	}

	option = {
		name = lv_scenario_cob.0510.a

		hidden_effect = {
			if = {
				limit = { has_title = title:k_volantis }
				destroy_title = title:k_volantis
			}
			title:c_old_volantis = {
				set_county_faith = root.faith
				set_county_culture = root.culture	
			}
		get_title = title:k_volantis
		}
		get_title = title:e_new_valyria
		remove_character_flag = not_had_coronation
		remove_character_modifier = uncoronated_modifier
		add_character_modifier = coronation_appropriate_modifier
	}
}

lv_scenario_cob.0511 = { #Aurion Varezys takes Volantis and calls upon other Dragonlords
	type = character_event
	title = lv_scenario_cob.0511.t
	desc = lv_scenario_cob.0511.desc

	theme = war
	override_background = {
		reference = agot_pk_high_crownlands
	}
	left_portrait = {
		character = root
		animation = map_rage
	}
	right_portrait = {
		character = scope:urnebar
		animation = marshall
	}

	trigger = {
	}

	immediate = {
		set_variable = dragonlord_of_valyria
		hidden_effect = { create_dragonlord_of_valyria_effect = yes }
		character:Urnebar_1 = {
			save_scope_as = urnebar
			set_variable = dragonlord_of_valyria
			hidden_effect = { create_dragonlord_of_valyria_effect = yes }
		}
		character:Mataeryon_1 = {
			save_scope_as = mataeryon
			set_variable = dragonlord_of_valyria
			hidden_effect = { create_dragonlord_of_valyria_effect = yes }
		}
		character:Sonaryen_1 = {
			save_scope_as = sonaryen
			set_variable = dragonlord_of_valyria
			hidden_effect = { create_dragonlord_of_valyria_effect = yes }
		}
		random_owned_story = {
			limit = {
				story_type = story_lv_century_of_blood_new_valyria
			}
			save_scope_as = new_valyria_story
		}
	}

	option = { #Attack Tyrosh to Install Urnebar
		name = lv_scenario_cob.0511.a
		trigger = {
			NOT = {
				title:k_tyrosh.holder = {
					has_variable = dragonlord_of_valyria
				}
			}
		}
		start_war = {
			casus_belli = cob_new_valyria_conquest_cb
			target = title:k_tyrosh.holder
			claimant = character:Urnebar_1
			target_title = title:k_tyrosh
		}
	}

	option = { #Attack Lys to install Sonaryen
		name = lv_scenario_cob.0511.b
		trigger = {
			NOT = {
				title:k_lys = {
					has_variable = dragonlord_of_valyria
				}
			}
		}
		start_war = { 
			casus_belli = cob_new_valyria_conquest_cb
			target = title:k_lys.holder
			claimant = character:Sonaryen_1
			target_title = title:k_lys
		}
	}

	option = { #Attack Myr to install Mataeryon
		name = lv_scenario_cob.0511.c
		trigger = {
			NOT = {
				title:k_myr.holder = {
					has_variable = dragonlord_of_valyria
				}
			}
		}
		start_war = { 
			casus_belli = cob_new_valyria_conquest_cb
			target = title:k_myr.holder
			claimant = character:Mataeryon_1
			target_title = title:k_lys
		}
	}

	#Dragonlords Join Together
	after = {
		root = {
			every_character_war = {
				limit = {
					OR = {
						using_cb = cob_new_valyria_conquest_cb
					}
					is_attacker = root
				}
				add_to_list = cob_new_valyria_wars
			}
		}
		scope:new_valyria_story = {
			every_in_list = {
				variable = dragonlord_of_valyria
				limit = {
					is_alive = yes
				}
				every_in_list = {
					list = cob_new_valyria_wars
					limit = {
						NOT = { is_participant = prev }
					}
					add_attacker = prev
				}
			}
		}
	}
}

# Recursive Maelys War Declaration Event
agot_ninepenny.0002 = {
	type = character_event
	title = agot_ninepenny.0002.t
	desc = {
		first_valid = { #Variable set in the ninepenny conquest war
			triggered_desc = {
				trigger = {
					scope:ninepenny_story = {
						var:recent_conquest = title:k_tyrosh
					}
				}
				desc = agot_ninepenny.0002.desc.tyrosh
			}
			triggered_desc = {
				trigger = {
					scope:ninepenny_story = {
						var:recent_conquest = title:k_lys
					}
				}
				desc = agot_ninepenny.0002.desc.lys
			}
			triggered_desc = {
				trigger = {
					scope:ninepenny_story = {
						var:recent_conquest = title:k_pentos
					}
				}
				desc = agot_ninepenny.0002.desc.pentos
			}
			triggered_desc = {
				trigger = {
					scope:ninepenny_story = {
						var:recent_conquest = title:k_myr
					}
				}
				desc = agot_ninepenny.0002.desc.myr
			}
			triggered_desc = {
				trigger = {
					scope:ninepenny_story = {
						var:recent_conquest = title:k_the_stepstones
					}
				}
				desc = agot_ninepenny.0002.desc.stepstones
			}
			desc = agot_ninepenny.0002.desc #Fallback for invalidated war
		}
	}

	theme = war

	left_portrait = {
		character = root
		animation = marshal
	}

	right_portrait = {
		trigger = { #In case we run out of kings
			exists = scope:ascendant
		}
		character = scope:ascendant #From the victorious war
	}

	trigger = {
	}

	immediate = {
		character:Targaryen_94 = { #For loc
			save_scope_as = daemon
		}
		character:Adarys_1 = {
			save_scope_as = adarys
			set_variable = dragonlord_of_valyria
		}
		character:Saan_1 = {
			save_scope_as = saan
			set_variable = dragonlord_of_valyria
		}
		character:Lashare_1 = {
			save_scope_as = lashare
		}
		character:Nine_Eyes_1 = {
			save_scope_as = nine_eyes
		}
		random_owned_story = {
			limit = {
				story_type = story_agot_dragonlord_of_valyrias
			}
			save_scope_as = ninepenny_story
		}
		#Save the appropriate king depending on the title claimed
		if = {
			limit = {
				scope:ninepenny_story = {
					var:recent_conquest = title:k_tyrosh
				}
			}
			character:Adarys_1 = {
				save_scope_as = ascendant
			}
		}
		else_if = {
			limit = {
				scope:ninepenny_story = {
					var:recent_conquest = title:k_lys
				}
			}
			character:Saan_1 = {
				save_scope_as = ascendant
			}
		}
		else_if = {
			limit = {
				scope:ninepenny_story = {
					var:recent_conquest = title:k_pentos
				}
			}
			character:Nine_Eyes_1 = {
				save_scope_as = ascendant
			}
		}
		else_if = {
			limit = {
				scope:ninepenny_story = {
					var:recent_conquest = title:k_myr
				}
			}
			character:Lashare_1 = {
				save_scope_as = ascendant
			}
		}
		else = { #Fallback - Grab a random king
			scope:ninepenny_story = {
				random_in_list = {
					variable = band_of_nine
					limit = {
						is_alive = yes
						NOT = {
							this = root
						}
					}
					save_scope_as = ascendant
				}
			}
		}
	}

	option = { #Attack Tyrosh to Install Adarys
		name = agot_ninepenny.0001.a
		trigger = {
			NOT = {
				title:k_tyrosh.holder = {
					has_variable = dragonlord_of_valyria
				}
			}
			character:Adarys_1 ?= {
				is_alive = yes
			}
		}
		start_war = {
			casus_belli = cob_new_valyria_conquest_cb
			target = title:k_tyrosh.holder
			claimant = character:Adarys_1
			target_title = title:k_tyrosh
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_3
			}
		}
	}

	option = { #Attack Stepstones as a Staging ground to attack Westeros
		name = agot_ninepenny.0001.b
		trigger = {
			NOT = {
				title:k_the_stepstones.holder ?= {
					has_variable = dragonlord_of_valyria
				}
			}
			NOT = {
				root = { has_title = title:e_the_iron_throne }
			}
		}
		start_war = { #Make an event that causes the pirates to band together ?
			casus_belli = cob_new_valyria_conquest_cb
			target = title:d_first_stepstones.holder
			claimant = character:Blackfyre_14
			target_title = title:k_the_stepstones
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_outcome_3
			}
		}
	}

	#Already Taken IT
	option = {
		name = agot_ninepenny.0001.b.alt
		trigger = {
			NOT = {
				title:k_the_stepstones.holder ?= {
					has_variable = dragonlord_of_valyria
				}
			}
			root = { has_title = title:e_the_iron_throne }
			character:Old_Mother_1 = { is_alive = yes }
		}
		start_war = { #Make an event that causes the pirates to band together ?
			casus_belli = cob_new_valyria_conquest_cb
			target = title:d_first_stepstones.holder
			claimant = character:Old_Mother_1
			target_title = title:k_the_stepstones
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_3
			}
		}
	}

	option = { #Attack Lys Install Saan
		name = agot_ninepenny.0001.c
		trigger = {
			NOT = {
				title:k_lys.holder = {
					has_variable = dragonlord_of_valyria
				}
			}
			character:Saan_1 ?= {
				is_alive = yes
			}
		}
		start_war = {
			casus_belli = cob_new_valyria_conquest_cb
			target = title:k_lys.holder
			claimant = character:Saan_1
			target_title = title:k_lys
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_3
			}
		}
	}

	option = { #Attack Myr install Lashare
		name = agot_ninepenny.0001.d
		trigger = {
			NOT = {
				title:k_myr.holder = {
					has_variable = dragonlord_of_valyria
				}
			}
			character:Lashare_1 ?= {
				is_alive = yes
			}
		}
		start_war = {
			casus_belli = cob_new_valyria_conquest_cb
			target = title:k_myr.holder
			claimant = character:Lashare_1
			target_title = title:k_myr
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_3
			}
		}
	}

	option = { #Attack Pentos install Nine-Eyes
		name = agot_ninepenny.0001.e
		trigger = {
			NOT = {
				title:k_pentos.holder = {
					has_variable = dragonlord_of_valyria
				}
			}
			title:k_myr.holder = { #No marching through Myr to march back
				has_variable = dragonlord_of_valyria
			}
			character:Nine_Eyes_1 ?= {
				is_alive = yes
			}
		}
		start_war = {
			casus_belli = cob_new_valyria_conquest_cb
			target = title:k_pentos.holder
			claimant = character:Nine_Eyes_1
			target_title = title:k_pentos
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_nonhistoric_outcome_3
			}
		}
	}

	option = { #Attack Westeros to install Maelys
		name = agot_ninepenny.0001.f
		trigger = {
			# Maelys cannot have the throne already
			NOT = {
				root = { has_title = title:e_the_iron_throne }
			}
			title:d_first_stepstones.holder ?= {
				OR = {
					has_variable = dragonlord_of_valyria
					top_liege = { has_variable = dragonlord_of_valyria }
				}
			}
		}
		start_war = {
			casus_belli = agot_blackfyre_claim
			target = title:e_the_iron_throne.holder
			claimant = root
			target_title = title:e_the_iron_throne
		}
		ai_chance = {
			base = 0
			modifier = {
				add = agot_historic_outcome_3
			}
		}
	}

	#Ninepenny Kings all join together
	after = {
		root = {
			every_character_war = {
				limit = {
					OR = {
						using_cb = cob_new_valyria_conquest_cb
						using_cb = agot_blackfyre_claim
					}
					is_attacker = root
				}
				add_to_list = ninepenny_wars
			}
		}
		scope:ninepenny_story = {
			every_in_list = {
				variable = band_of_nine
				limit = {
					is_alive = yes
				}
				every_in_list = {
					list = ninepenny_wars
					limit = {
						NOT = { is_participant = prev }
					}
					add_attacker = prev
				}
			}
		}
	}
}
