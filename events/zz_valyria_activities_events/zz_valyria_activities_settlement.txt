namespace = zz_valyria_settlement


# INVALIDATION - PRISON
zz_valyria_settlement.0005 = {
	type = character_event
	title = zz_valyria_settlement.0005.t
	desc = zz_valyria_settlement.0005.desc
	theme = prison

	left_portrait = {
		character = root
		animation = prisonhouse
	}

	immediate = {
		imprisoner ?= {
			save_scope_as = jailor
		}
		create_character_memory = {
			type = imprisoned_adult_education
			participants = {
				jailor = scope:jailor
			}
		}
	}

	option = {
		name = zz_valyria_settlement.0005.a
	}
}



# CONCLUSION EVENT
zz_valyria_settlement.0009 = {
	type = activity_event
	title = zz_valyria_settlement.0009.t
	desc = {
		desc = zz_valyria_settlement.0009.desc
		triggered_desc = {
			trigger = {
				scope:host = { 
					has_character_flag = perfect_reward 
				}
			}
			desc = zz_valyria_settlement.0009.desc_perfect_reward
		}
		triggered_desc = {
			trigger = {
				scope:host = { 
					has_character_flag = high_reward 
				}
			}
			desc = zz_valyria_settlement.0009.desc_high_reward
		}
		triggered_desc = {
			trigger = {
				scope:host = { 
					has_character_flag = ok_reward 
				}
			}
			desc = zz_valyria_settlement.0009.desc_ok_reward
		}
	}
	theme = university

	center_portrait = {
		character = root
		animation = thinking
	}

	immediate = {
		#Reward effects
		valyria_settlement_completed_log_entry_effect = yes
		
		involved_activity ?= {
			#Perfect settlement - 75-100
			if = {
				limit = { var:activity_special_type_progression >= 75 }
				scope:host = {
					add_character_flag = perfect_reward
				}
			}
			#High-end settlement - 50-75
			else_if = {
				limit = { 
					var:activity_special_type_progression < 75
					var:activity_special_type_progression >= 50
				} 
				scope:host = {
					add_character_flag = high_reward
				}
			}
			#OK settlement - 25-50
			else_if = {
				limit = {
					var:activity_special_type_progression < 50
					var:activity_special_type_progression >= 25
				}
				scope:host = {
					add_character_flag = ok_reward
				}
			}
		}
	}
	option = {
		name = zz_valyria_settlement.0009.a
		trigger = {
			has_character_flag = perfect_reward
		}
		custom_tooltip = zz_valyria_colonisation.0009.perfect_reward
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = zz_valyria_settlement.0009.b
		trigger = {
			has_character_flag = high_reward
		}
		custom_tooltip = zz_valyria_colonisation.0009.high_reward
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = zz_valyria_settlement.0009.c
		trigger = {
			has_character_flag = ok_reward
		}
		add_gold = 300
		ai_chance = {
			base = 100
		}
	}
	after = { 
		remove_character_flag = perfect_reward
		remove_character_flag = high_reward
		remove_character_flag = ok_reward
		
		remove_character_flag = large_settlement_development_gain
		remove_character_flag = med_settlement_development_gain
	}
}

## ARRIVAL EVENTS
zz_valyria_settlement.0010 = {
	type = activity_event
	title = zz_valyria_settlement.0010.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					"scope:host.capital_province.squared_distance(scope:location)" >= squared_distance_massive
				}
				desc = zz_valyria_settlement.0010.arrival.desc_very_very_far
			}
			triggered_desc = {
				trigger = {
					"scope:host.capital_province.squared_distance(scope:location)" >= 0
				}
				desc = zz_valyria_settlement.0010.arrival.desc_same_province
			}
			triggered_desc = {
				trigger = {
					NOT = { "scope:host.capital_province.squared_distance(scope:location)" >= squared_distance_massive }
				}
				desc = zz_valyria_settlement.0010.arrival.desc
			}
		}
	}
	theme = university

	center_portrait = {
		character = root
		animation = happy_teacher
	}

	immediate = {
		scope:activity.activity_location = { save_scope_as = location }
	}

	option = {
		name = zz_valyria_settlement.0010.a
	}
}

## Destination Events 
## Progress Event Learning
zz_valyria_settlement.0100 = {
	type = activity_event
	title = zz_valyria_settlement.0100.t
	desc = zz_valyria_settlement.0100.desc
	theme = university

	center_portrait = {
		character = root
		animation = personality_rational
	}

	cooldown = { years = 1 }

	trigger = {
		always = yes
	}

	weight_multiplier = {
		base = 1
		modifier = {
			has_trait = theologian
			add = 2
		}
		modifier = {
			has_trait = scholar
			add = 1
		}
	}

	immediate = {
		scope:activity = {
			activity_location = { save_scope_as = location }
		}
		root = { save_scope_as = book_creator }
	}

	# Option A: Study hard intent: think and try to resolve the questions
	option = {
		name = zz_valyria_settlement.0100.a
		trigger = {
		}
		duel = {
			skill = learning
			value = high_skill_rating
			30 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = zz_valyria_settlement.0100.a.crit_success
				send_interface_toast = {
					title = zz_valyria_settlement.0100.a.crit_success.tt
					left_icon = root
					
					#custom_tooltip = zz_valyria_settlement.0100.a.tt
					scope:activity = {
						add_activity_log_entry = {
							key = sic_et_non_log
							score = 25
							tags = { good learning activity }
							character = root
			
							#Effect
							custom_tooltip = zz_valyria_settlement_tt_positive_massive
							scope:activity = { activity_special_type_progression_massive = yes }
							add_character_flag = learning_building_flag
						}
					}
				}
				stress_impact = {
					base = medium_stress_impact_loss
				}
			}
			35 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = zz_valyria_settlement.0100.a.success
				send_interface_toast = {
					title = zz_valyria_settlement.0100.a.success.tt
					left_icon = root
					custom_tooltip = zz_valyria_settlement_tt_positive_major
					scope:activity = { activity_special_type_progression_major = yes }
				}
				stress_impact = {
					base = minor_stress_impact_loss
				}
			}
			35 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				desc = zz_valyria_settlement.0100.a.failure
				send_interface_toast = {
					title = zz_valyria_settlement.0100.a.failure.tt
					left_icon = root
					hidden_effect = {
						custom_tooltip = zz_valyria_settlement_tt_negative
						scope:activity = { activity_special_type_progression_negative = yes }
					}
				}
				stress_impact = {
					base = medium_stress_impact_gain
				}
			}
		}
		
		ai_chance = {
			base = 100
		}
	}


	# Option C: opt-out
	option = {
		name = zz_valyria_settlement.0100.c
		stress_impact = {
			base = medium_stress_impact_loss
		}
		ai_chance = {
			base = 50
			modifier = {
				has_trait = lazy
				add = 100
			}
			modifier = {
				has_trait = intellect_bad
				add = 100
			}
			modifier = {
				has_trait = dull
				add = 100
			}
		}
	}
}

## Progress Event Stewardship
zz_valyria_settlement.0200 = {
	type = activity_event
	title = zz_valyria_settlement.0200.t
	desc = zz_valyria_settlement.0200.desc
	theme = university

	center_portrait = {
		character = root
		animation = personality_rational
	}

	cooldown = { years = 1 }

	trigger = {
		always = yes
	}

	weight_multiplier = {
		base = 1
		modifier = {
			has_trait = theologian
			add = 2
		}
		modifier = {
			has_trait = scholar
			add = 1
		}
	}

	immediate = {
		scope:activity = {
			activity_location = { save_scope_as = location }
		}
		root = { save_scope_as = book_creator }
	}

	# Option A: Study hard intent: think and try to resolve the questions
	option = {
		name = zz_valyria_settlement.0200.a
		trigger = {
		}
		duel = {
			skill = stewardship
			value = high_skill_rating
			30 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = zz_valyria_settlement.0200.a.crit_success
				send_interface_toast = {
					title = zz_valyria_settlement.0200.a.crit_success.tt
					left_icon = root
					
					custom_tooltip = zz_valyria_settlement.0200.a.crit_success_dev_tt
					scope:activity = {
						add_activity_log_entry = {
							key = sic_et_non_log
							score = 25
							tags = { good learning activity }
							character = root
							
							scope:host = {
								add_character_flag = large_settlement_development_gain
							}
							
							#Effect
							custom_tooltip = zz_valyria_settlement_tt_positive_massive
							scope:activity = { activity_special_type_progression_massive = yes }
							add_character_flag = stewardship_building_flag
						}
					}
				}
				stress_impact = {
					base = medium_stress_impact_loss
				}
			}
			35 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = zz_valyria_settlement.0200.a.success
				send_interface_toast = {
					title = zz_valyria_settlement.0200.a.success.tt
					left_icon = root
					
					custom_tooltip = zz_valyria_settlement.0200.a.success_dev_tt
					scope:host = {
						add_character_flag = med_settlement_development_gain
					}
					
					custom_tooltip = zz_valyria_settlement_tt_positive_major
					scope:activity = { activity_special_type_progression_major = yes }
				}
			}
			35 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				desc = zz_valyria_settlement.0200.a.failure
				send_interface_toast = {
					title = zz_valyria_settlement.0200.a.failure.tt
					left_icon = root
					hidden_effect = {
						custom_tooltip = zz_valyria_settlement_tt_negative
						scope:activity = { activity_special_type_progression_negative = yes }
					}
				}
			}
		}
		
		ai_chance = {
			base = 100
		}
	}


	# Option C: opt-out
	option = {
		name = zz_valyria_settlement.0200.c
		stress_impact = {
			base = medium_stress_impact_loss
		}
		ai_chance = {
			base = 50
			modifier = {
				has_trait = lazy
				add = 100
			}
			modifier = {
				has_trait = intellect_bad
				add = 100
			}
			modifier = {
				has_trait = dull
				add = 100
			}
		}
	}
}

## Progress Event Diplomacy - Rogue Colonists
zz_valyria_settlement.0300 = {
	type = activity_event
	title = zz_valyria_settlement.0300.t
	desc = zz_valyria_settlement.0300.desc
	theme = university

	center_portrait = {
		character = root
		animation = personality_rational
	}

	cooldown = { years = 1 }

	trigger = {
		always = yes
	}

	weight_multiplier = {
		base = 1
		modifier = {
			has_trait = theologian
			add = 2
		}
		modifier = {
			has_trait = scholar
			add = 1
		}
	}

	immediate = {
		scope:activity = {
			activity_location = { save_scope_as = location }
		}
		root = { save_scope_as = book_creator }
	}

	# Option A: Study hard intent: think and try to resolve the questions
	option = {
		name = zz_valyria_settlement.0300.a
		trigger = {
		}
		duel = {
			skill = diplomacy
			value = high_skill_rating
			30 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = zz_valyria_settlement.0300.a.crit_success
				send_interface_toast = {
					title = zz_valyria_settlement.0300.a.crit_success.tt
					left_icon = root
					
					#custom_tooltip = zz_valyria_settlement.0300.a.tt
					scope:activity = {
						add_activity_log_entry = {
							key = sic_et_non_log
							score = 25
							tags = { good learning activity }
							character = root
			
							#Effect
							custom_tooltip = zz_valyria_settlement_tt_positive_massive
							scope:activity = { activity_special_type_progression_massive = yes }
							add_character_flag = diplomacy_building_flag
						}
					}
				}
				stress_impact = {
					base = medium_stress_impact_loss
				}
			}
			35 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = zz_valyria_settlement.0300.a.success
				send_interface_toast = {
					title = zz_valyria_settlement.0300.a.success.tt
					left_icon = root
					custom_tooltip = zz_valyria_settlement_tt_positive_major
					scope:activity = { activity_special_type_progression_major = yes }
				}
				stress_impact = {
					base = minor_stress_impact_loss
				}
			}
			35 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				desc = zz_valyria_settlement.0300.a.failure
				send_interface_toast = {
					title = zz_valyria_settlement.0300.a.failure.tt
					left_icon = root
					hidden_effect = {
						custom_tooltip = zz_valyria_settlement_tt_negative
						scope:activity = { activity_special_type_progression_negative = yes }
					}
				}
				stress_impact = {
					base = medium_stress_impact_gain
				}
			}
		}
		
		ai_chance = {
			base = 100
		}
	}


	# Option C: opt-out
	option = {
		name = zz_valyria_settlement.0300.c
		remove_short_term_gold = {
			gold = {
				value = root.medium_gold_min_value
			}
		}
		ai_chance = {
			base = 50
			modifier = {
				has_trait = lazy
				add = 100
			}
			modifier = {
				has_trait = intellect_bad
				add = 100
			}
			modifier = {
				has_trait = dull
				add = 100
			}
		}
	}
}

## Progress Event Intrigue - Smuggling
zz_valyria_settlement.0400 = {
	type = activity_event
	title = zz_valyria_settlement.0400.t
	desc = zz_valyria_settlement.0400.desc
	theme = university

	center_portrait = {
		character = root
		animation = personality_rational
	}

	cooldown = { years = 1 }

	trigger = {
		always = yes
	}

	weight_multiplier = {
		base = 1
		modifier = {
			has_trait = theologian
			add = 2
		}
		modifier = {
			has_trait = scholar
			add = 1
		}
	}

	immediate = {
		scope:activity = {
			activity_location = { save_scope_as = location }
		}
		root = { save_scope_as = book_creator }
	}

	# Option A: Study hard intent: think and try to resolve the questions
	option = {
		name = zz_valyria_settlement.0400.a
		trigger = {
		}
		duel = {
			skill = intrigue
			value = high_skill_rating
			30 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = zz_valyria_settlement.0400.a.crit_success
				send_interface_toast = {
					title = zz_valyria_settlement.0400.a.crit_success.tt
					left_icon = root
					
					custom_tooltip = zz_valyria_settlement.0400.a.tt
					scope:activity = {
						add_activity_log_entry = {
							key = sic_et_non_log
							score = 25
							tags = { good learning activity }
							character = root
							hidden_effect = {
								random_list = {
									70 = {
										agot_create_artifact_glass_candle_effect = { OWNER = scope:host  COLOR = purple }
									}
									10 = {
										agot_create_artifact_vs_valyrian_longsword_silver_effect = { OWNER = scope:host } 
									}
									10 = {
										agot_create_artifact_vs_valyrian_longsword_gold_effect = { OWNER = scope:host } 
									}
									10 = {
										agot_create_artifact_vs_valyrian_armingsword_silver_effect = { OWNER = scope:host } 
									}
									10 = {
										agot_create_artifact_vs_valyrian_armingsword_gold_effect = { OWNER = scope:host } 
									}
									10 = {
										agot_create_artifact_valyrian_steel_armor_effect = { OWNER = scope:host } 
									}
									10 = {
										agot_create_random_dragon_egg_artifact = { OWNER = scope:host }
									}
								}
							}
							#Effect
							add_character_flag = intrigue_building_flag
							custom_tooltip = zz_valyria_settlement_tt_positive_massive
							scope:activity = { activity_special_type_progression_massive = yes }
						}
					}
				}
				stress_impact = {
					base = medium_stress_impact_loss
				}
			}
			35 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = zz_valyria_settlement.0400.a.success
				send_interface_toast = {
					title = zz_valyria_settlement.0400.a.success.tt
					left_icon = root
					custom_tooltip = zz_valyria_settlement_tt_positive_major
					scope:activity = { activity_special_type_progression_major = yes }
				}
				stress_impact = {
					base = minor_stress_impact_loss
				}
			}
			35 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				desc = zz_valyria_settlement.0400.a.failure
				send_interface_toast = {
					title = zz_valyria_settlement.0400.a.failure.tt
					left_icon = root
					hidden_effect = {
						custom_tooltip = zz_valyria_settlement_tt_negative
						scope:activity = { activity_special_type_progression_negative = yes }
					}
				}
				stress_impact = {
					base = medium_stress_impact_gain
				}
			}
		}
		
		ai_chance = {
			base = 100
		}
	}


	# Option C: opt-out
	option = {
		name = zz_valyria_settlement.0400.c
		stress_impact = {
			base = medium_stress_impact_loss
		}
		ai_chance = {
			base = 50
			modifier = {
				has_trait = lazy
				add = 100
			}
			modifier = {
				has_trait = intellect_bad
				add = 100
			}
			modifier = {
				has_trait = dull
				add = 100
			}
		}
	}
}

## Progress Event Martial
zz_valyria_settlement.0500 = {
	type = activity_event
	title = zz_valyria_settlement.0500.t
	desc = zz_valyria_settlement.0500.desc
	theme = university

	center_portrait = {
		character = root
		animation = personality_rational
	}

	cooldown = { years = 1 }

	trigger = {
		always = yes
	}

	weight_multiplier = {
		base = 1
		modifier = {
			has_trait = theologian
			add = 2
		}
		modifier = {
			has_trait = scholar
			add = 1
		}
	}

	immediate = {
		scope:activity = {
			activity_location = { save_scope_as = location }
		}
		root = { save_scope_as = book_creator }
	}

	# Option A: Study hard intent: think and try to resolve the questions
	option = {
		name = zz_valyria_settlement.0500.a
		trigger = {
		}
		duel = {
			skill = martial
			value = high_skill_rating
			30 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = zz_valyria_settlement.0500.a.crit_success
				send_interface_toast = {
					title = zz_valyria_settlement.0500.a.crit_success.tt
					left_icon = root
					
					#custom_tooltip = zz_valyria_settlement.0500.a.tt
					scope:activity = {
						add_activity_log_entry = {
							key = sic_et_non_log
							score = 25
							tags = { good learning activity }
							character = root
			
							#Effect
							add_character_flag = martial_building_flag
							custom_tooltip = zz_valyria_settlement_tt_positive_massive
							scope:activity = { activity_special_type_progression_massive = yes }
						}
					}
				}
			}
			35 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = zz_valyria_settlement.0500.a.success
				send_interface_toast = {
					title = zz_valyria_settlement.0500.a.success.tt
					left_icon = root
					custom_tooltip = zz_valyria_settlement_tt_positive_major
					scope:activity = { activity_special_type_progression_major = yes }
				}
			}
			35 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				desc = zz_valyria_settlement.0500.a.failure
				send_interface_toast = {
					title = zz_valyria_settlement.0500.a.failure.tt
					left_icon = root
					hidden_effect = {
						custom_tooltip = zz_valyria_settlement_tt_negative
						scope:activity = { activity_special_type_progression_negative = yes }
					}
				}
				stress_impact = {
					base = medium_stress_impact_gain
				}
			}
		}
		
		ai_chance = {
			base = 100
		}
	}


	# Option C: opt-out
	option = {
		name = zz_valyria_settlement.0500.c
		stress_impact = {
			base = medium_stress_impact_loss
		}
		ai_chance = {
			base = 50
			modifier = {
				has_trait = lazy
				add = 100
			}
			modifier = {
				has_trait = intellect_bad
				add = 100
			}
			modifier = {
				has_trait = dull
				add = 100
			}
		}
	}
}

## Progress Event - Firewrym Attack
zz_valyria_settlement.0600 = {
	type = activity_event
	title = zz_valyria_settlement.0600.t
	desc = zz_valyria_settlement.0600.desc
	theme = university

	center_portrait = {
		character = root
		animation = personality_rational
	}

	cooldown = { years = 1 }

	trigger = {
		always = yes
	}

	weight_multiplier = {
		base = 1
		modifier = {
			has_trait = theologian
			add = 2
		}
		modifier = {
			has_trait = scholar
			add = 1
		}
	}

	immediate = {
		scope:activity = {
			activity_location = { save_scope_as = location }
		}
		root = { save_scope_as = book_creator }
	}

	# Option A: Confront Firewrym
	option = {
		name = zz_valyria_settlement.0600.a
		trigger = {
		}
		duel = {
			skill = prowess
			value = high_skill_rating
			30 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = zz_valyria_settlement.0600.a.crit_success
				send_interface_toast = {
					title = zz_valyria_settlement.0600.a.crit_success.tt
					left_icon = root
					
					#custom_tooltip = zz_valyria_settlement.0600.a.tt
					add_prestige = monumental_prestige_gain
					if = {
						limit = {
							OR = {
								has_any_nickname = no
								has_bad_nickname = yes
							}
						}
						random_list = {
							50 = { # Nickname
								give_nickname = nick_the_wyrmslayer
							}
							50 = { }
						}
						
					}
					scope:activity = {
						add_activity_log_entry = {
							key = sic_et_non_log
							score = 25
							tags = { good prowess activity }
							character = root
			
							#Effect
							add_character_flag = prowess_building_flag
							custom_tooltip = zz_valyria_settlement_tt_positive_massive
							scope:activity = { activity_special_type_progression_massive = yes }
						}
					}
				}
			}
			35 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = zz_valyria_settlement.0600.a.success
				send_interface_toast = {
					title = zz_valyria_settlement.0600.a.success.tt
					left_icon = root
					custom_tooltip = zz_valyria_settlement_tt_positive_major
					scope:activity = { activity_special_type_progression_major = yes }
				}
			}
			35 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				desc = zz_valyria_settlement.0600.a.failure
				send_interface_toast = {
					title = zz_valyria_settlement.0600.a.failure.tt
					left_icon = root
					hidden_effect = {
						custom_tooltip = zz_valyria_settlement_tt_negative
						scope:activity = { activity_special_type_progression_negative = yes }
					}
				}
				random_list = {
					25 = { # Death
						death = {
							death_reason = death_dragon_ate
						}
					}
					30 = { # Maimed
						add_trait = maimed
					}
					50 = { # Wounding
						add_trait = wounded_1
					}
				}
			}
		}
		
		ai_chance = {
			base = 100
		}
	}


	# Option C: opt-out
	option = {
		name = zz_valyria_settlement.0600.c
		stress_impact = {
			base = medium_stress_impact_loss
		}
		ai_chance = {
			base = 50
			modifier = {
				has_trait = lazy
				add = 100
			}
			modifier = {
				has_trait = intellect_bad
				add = 100
			}
			modifier = {
				has_trait = dull
				add = 100
			}
		}
	}
}



## Get Valyrian Tomes
zz_valyria_settlement.4000 = {
	type = activity_event
	title = zz_valyria_settlement.4000.t
	theme = university
	
	desc = {
		first_valid = {
			desc = zz_valyria_settlement.4000.desc_begin
		}
		triggered_desc = {
			trigger = {
				NOT = { # Doesn't have the Dragonlore Book
					any_character_artifact = {
						has_artifact_modifier = dragonlore_book_modifier
					}
				}
			}
			desc = zz_valyria_settlement.4000.dragonlore_book
		}
		triggered_desc = {
			trigger = {
				always = yes
			}
			desc = zz_valyria_settlement.4000.magic_book
		}
		triggered_desc = {
			trigger = {
				always = yes
			}
			desc = zz_valyria_settlement.4000.medicine_book
		}
		desc = zz_valyria_settlement.4000.desc_end
		
	}
	
	center_portrait = {
		character = root
		animation = personality_rational
	}

	cooldown = { years = 1 }

	trigger = {
		NOT = { # Doesn't have all the books
			any_character_artifact = {
				has_artifact_modifier = valyrian_life_book_modifier
			}
			any_character_artifact = {
				has_artifact_modifier = dragonlore_book_modifier
			}
		}
	}

	weight_multiplier = {
		base = 1
		modifier = {
			has_trait = theologian
			add = 2
		}
		modifier = {
			has_trait = scholar
			add = 1
		}
	}

	immediate = {
		scope:activity = {
			activity_location = { save_scope_as = location }
		}
	}

	# Option A: Spellbook
	option = {
		name = zz_valyria_settlement.4000.a
		trigger = {
		}
		duel = {
			skill = prowess
			value = high_skill_rating
			35 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = zz_valyria_settlement.4000.a.crit_success
				send_interface_toast = {
					title = zz_valyria_settlement.4000.a.crit_success.tt
					left_icon = root
					#custom_tooltip = zz_valyria_settlement.4000.a.tt
					
					######################## INSERT TOME OF SPELLCASTING HERE ###########################
					
					scope:activity = {
						add_activity_log_entry = {
							key = sic_et_non_log
							score = 25
							tags = { good learning activity }
							character = root
							hidden_effect = {
								custom_tooltip = zz_valyria_settlement_tt_positive_massive
								scope:activity = { activity_special_type_progression_massive = yes }
							}
						}
					}
				}
				stress_impact = {
					base = medium_stress_impact_loss
				}
			}
			65 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				desc = zz_valyria_settlement.4000.a.failure
				send_interface_toast = {
					title = zz_valyria_settlement.4000.a.failure.tt
					left_icon = root
					hidden_effect = {
						custom_tooltip = zz_valyria_settlement_tt_negative
						scope:activity = { activity_special_type_progression_negative = yes }
					}
				}
				random_list = {
					25 = { # Death
						death = {
							death_reason = death_accident
						}
					}
					30 = { # Maimed
						add_trait = maimed
					}
					25 = { # Wounding
						add_trait = wounded_1
					}
					50 = { # Nothing
						
					}
				}
				stress_impact = {
					base = medium_stress_impact_gain
				}
			}
		}
		
		ai_chance = {
			base = 100
		}
	}
	# Option B: Dragonlore
	option = {
		name = zz_valyria_settlement.4000.b
		trigger = {
			NOT = { # Doesn't have the Dragonlore Book
				any_character_artifact = {
					has_artifact_modifier = dragonlore_book_modifier
				}
			}
		}
		duel = {
			skill = prowess
			value = high_skill_rating
			35 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = zz_valyria_settlement.4000.b.crit_success
				send_interface_toast = {
					title = zz_valyria_settlement.4000.b.crit_success.tt
					left_icon = root
					#custom_tooltip = zz_valyria_settlement.4000.b.tt
					agot_create_artifact_book_of_dragonlore = {
						OWNER = scope:host
					}
					scope:activity = {
						add_activity_log_entry = {
							key = sic_et_non_log
							score = 25
							tags = { good learning activity }
							character = root
			
							#Effect
							hidden_effect = {
								custom_tooltip = zz_valyria_settlement_tt_positive_massive
								scope:activity = { activity_special_type_progression_massive = yes }
							}
						}
					}
				}
				stress_impact = {
					base = medium_stress_impact_loss
				}
			}
			65 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				desc = zz_valyria_settlement.4000.a.failure
				send_interface_toast = {
					title = zz_valyria_settlement.4000.a.failure.tt
					left_icon = root
					hidden_effect = {
						custom_tooltip = zz_valyria_settlement_tt_negative
						scope:activity = { activity_special_type_progression_negative = yes }
					}
				}
				random_list = {
					25 = { # Death
						death = {
							death_reason = death_accident
						}
					}
					30 = { # Maimed
						add_trait = maimed
					}
					25 = { # Wounding
						add_trait = wounded_1
					}
					50 = { # Nothing
						
					}
				}
				stress_impact = {
					base = medium_stress_impact_gain
				}
			}
		}
		
		ai_chance = {
			base = 100
		}
	}
	# Option C: Medicine
	option = {
		name = zz_valyria_settlement.4000.c
		trigger = {
			NOT = { # Doesn't have the Medicine Book
				any_character_artifact = {
					has_artifact_modifier = valyrian_life_book_modifier
				}
			}
		}
		duel = {
			skill = prowess
			value = high_skill_rating
			35 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = 3.5
					min = -49
				}
				desc = zz_valyria_settlement.4000.c.crit_success
				send_interface_toast = {
					title = zz_valyria_settlement.4000.c.crit_success.tt
					left_icon = root
					#custom_tooltip = zz_valyria_settlement.4000.c.tt
					agot_create_artifact_book_of_life = {
						OWNER = scope:host
					}
					scope:activity = {
						add_activity_log_entry = {
							key = sic_et_non_log
							score = 25
							tags = { good learning activity }
							character = root
			
							#Effect
							hidden_effect = {
								custom_tooltip = zz_valyria_settlement_tt_positive_massive
								scope:activity = { activity_special_type_progression_massive = yes }
							}
						}
					}
				}
				stress_impact = {
					base = medium_stress_impact_loss
				}
			}
			65 = {
				compare_modifier = {
					value = scope:duel_value
					multiplier = -3.5
					min = -49
				}
				desc = zz_valyria_settlement.4000.a.failure
				send_interface_toast = {
					title = zz_valyria_settlement.4000.a.failure.tt
					left_icon = root
					hidden_effect = {
						custom_tooltip = zz_valyria_settlement_tt_negative
						scope:activity = { activity_special_type_progression_negative = yes }
					}
				}
				random_list = {
					25 = { # Death
						death = {
							death_reason = death_accident
						}
					}
					30 = { # Maimed
						add_trait = maimed
					}
					25 = { # Wounding
						add_trait = wounded_1
					}
					50 = { # Nothing
						
					}
				}
				stress_impact = {
					base = medium_stress_impact_gain
				}
			}
		}
		
		ai_chance = {
			base = 100
		}
	}
	# Option D: opt-out
	option = {
		name = zz_valyria_settlement.4000.d
		
		ai_chance = {
			base = 50
			modifier = {
				has_trait = lazy
				add = 100
			}
			modifier = {
				has_trait = intellect_bad
				add = 100
			}
			modifier = {
				has_trait = dull
				add = 100
			}
		}
	}
}