namespace = zz_valyria_item_crafting


# INVALIDATION - PRISON
zz_valyria_item_crafting.0005 = {
	type = character_event
	title = zz_valyria_item_crafting.0005.t
	desc = zz_valyria_item_crafting.0005.desc
	theme = prison

	left_portrait = {
		character = root
		animation = prisonhouse
	}

	immediate = {
		imprisoner ?= {
			save_scope_as = jailor
		}
		create_character_memory = {
			type = imprisoned_adult_education
			participants = {
				jailor = scope:jailor
			}
		}
	}

	option = {
		name = zz_valyria_item_crafting.0005.a
	}
}

# CONCLUSION EVENT
zz_valyria_item_crafting.0009 = {
	type = activity_event
	title = zz_valyria_item_crafting.0009.t
	desc = {
		desc = zz_valyria_item_crafting.0009.desc
		triggered_desc = {
			trigger = {
				scope:host = { 
					has_character_flag = crafting_successs_reward 
				}
			}
			desc = zz_valyria_item_crafting.0009.desc_perfect_reward
		}
		triggered_desc = {
			trigger = {
				scope:host = { 
					has_character_flag = crafting_failure_reward 
				}
			}
			desc = zz_valyria_item_crafting.0009.desc_ok_reward
		}
	}
	theme = university

	center_portrait = {
		character = root
		animation = thinking
	}

	immediate = {
		#Reward effects
		scope:activity.activity_location = { save_scope_as = location }
		valyria_item_crafting_completed_log_entry_effect = yes
		
		involved_activity ?= {
			#Perfect settlement - 65-100
			if = {
				limit = { var:activity_special_type_progression >= 65 }
				scope:host = {
					add_character_flag = crafting_successs_reward
				}
			}
			#crafting failure
			else = {
				scope:host = {
					add_character_flag = crafting_failure_reward
				}
			}
		}
	}
	option = {
		name = zz_valyria_item_crafting.0009.a
		trigger = {
			has_character_flag = crafting_successs_reward
		}
		custom_tooltip = zz_valyria_item_crafting.0009.crafting_successs_reward
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = zz_valyria_item_crafting.0009.b
		trigger = {
			has_character_flag = crafting_failure_reward
		}
		custom_tooltip = zz_valyria_item_crafting.0009.crafting_failure_reward
		ai_chance = {
			base = 100
		}
	}
	after = { 
		remove_character_flag = crafting_successs_reward
		remove_character_flag = crafting_failure_reward
		
	}
}

## ARRIVAL EVENTS
zz_valyria_item_crafting.0010 = {
	type = activity_event
	title = zz_valyria_item_crafting.0010.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					"scope:host.capital_province.squared_distance(scope:location)" >= squared_distance_massive
				}
				desc = zz_valyria_item_crafting.0010.arrival.desc_very_very_far
			}
			triggered_desc = {
				trigger = {
					"scope:host.capital_province.squared_distance(scope:location)" >= 0
				}
				desc = zz_valyria_item_crafting.0010.arrival.desc_same_province
			}
			triggered_desc = {
				trigger = {
					NOT = { "scope:host.capital_province.squared_distance(scope:location)" >= squared_distance_massive }
				}
				desc = zz_valyria_item_crafting.0010.arrival.desc
			}
		}
	}
	theme = university

	center_portrait = {
		character = root
		animation = happy_teacher
	}

	immediate = {
		scope:activity.activity_location = { save_scope_as = location }
	}

	option = {
		name = zz_valyria_item_crafting.0010.a
	}
}