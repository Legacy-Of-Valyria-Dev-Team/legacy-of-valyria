zz_valyria_dragon_training_action = {
	is_shown = {
		scope:actor = {
			has_character_flag = dragon_training
		}
	}
	is_valid_showing_failures_only = {
		scope:actor = {
		}
		scope:recipient = {
			exists = var:current_dragon
			OR = {
				has_trait = lifestyle_blademaster
				has_trait = lifestyle_reveler
				has_trait = lifestyle_hunter	
				has_trait = lifestyle_mystic
				has_trait = lifestyle_physician
				has_trait = lifestyle_herbalist
				has_trait = lifestyle_gardener 
			}
		}
	}
	icon = icon_magic
	common_interaction = yes
	interface_priority = 1000
	category = interaction_secrets_of_valyria

	cooldown_against_recipient = { days = 0 } 
	cooldown = { days = 30 } 
	ignores_pending_interaction_block = yes
	use_diplomatic_range = yes
	#hidden = yes
	
	on_accept = {
		scope:actor = {
			save_scope_as = magic_user
			send_interface_message = {
				type = event_generic_neutral
				title = zz_valyria_dragon_training.t
				desc = zz_valyria_dragon_training.desc
				left_icon = scope:actor
				right_icon = scope:recipient
				custom_tooltip = zz_valyria_dragon_training.tt
				if = {
					limit = {
						NOT = {
							scope:actor = scope:recipient
						}
					}
					stress_impact = {
						compassionate = medium_stress_impact_loss
						sadistic = minor_stress_gain
						callous = minor_stress_gain
					}
				}
			}
		}
		scope:recipient = {
			if = { 
				limit = { 
					scope:mage_blademaster_dragon_trainer = yes 
				}
				scope:recipient = {
					if = {
						limit = {
							exists = var:current_dragon
							has_trait = lifestyle_blademaster
						}
						trigger_event = { 
							id =  zz_agot_filler_dragon.4
						}
					}
				}
			}
			else_if = { 
				limit = { 
					scope:mage_hunter_dragon_trainer = yes 
				}
				scope:recipient = {
					if = {
						limit = {
							exists = var:current_dragon
							has_trait = lifestyle_hunter
						}
						trigger_event = { 
							id =  zz_agot_filler_dragon.6
						}
					}
				}
			}
			else_if = { 
				limit = { 
					scope:mage_mystic_dragon_trainer = yes 
				}
				scope:recipient = {
					if = {
						limit = {
							exists = var:current_dragon
							has_trait = lifestyle_mystic
						}
						trigger_event = { 
							id =  zz_agot_filler_dragon.8
						}
					}
				}
			}
			else_if = { 
				limit = { 
					scope:mage_physician_dragon_trainer = yes 
				}
				scope:recipient = {
					if =  {
						limit = {
							exists = var:current_dragon
							has_trait = lifestyle_physician
						}
						trigger_event = { 
							id =  zz_agot_filler_dragon.10
						}
					}
				}
			}
			else_if = { 
				limit = { 
					scope:mage_herbalist_dragon_trainer = yes 
				}
				scope:recipient = {
					if = {
						limit = {
							exists = var:current_dragon
							has_trait = lifestyle_herbalist
						}
						trigger_event = { 
							id =  zz_agot_filler_dragon.12
						}
					}
				}
			}
			else_if = { 
				limit = { 
					scope:mage_gardener_dragon_trainer = yes 
				}
				scope:recipient = {
					if = {
						limit = {
							exists = var:current_dragon
							has_trait = lifestyle_gardener
						}
						trigger_event = { 
							id =  zz_agot_filler_dragon.14
						}
					}
				}
			}
			else_if = { 
				limit = { 
					scope:mage_reveler_dragon_trainer = yes 
				}
				scope:recipient = {
					if = {
						limit = {
							exists = var:current_dragon
							has_trait = lifestyle_reveler
						}
						trigger_event = { 
							id =  zz_agot_filler_dragon.2
						}
					}
				}
			}
			if = {
				limit = {
					NOT = { scope:actor = scope:recipient }
				}
				add_opinion = {
					modifier = grateful_opinion
					target = scope:actor
					opinion = 70
				}
			}
		}
	}
	send_options_exclusive = yes

	send_option = {
		flag = mage_blademaster_dragon_trainer
		localization = mage_blademaster_dragon_trainer
		is_shown = {
			scope:recipient = {
				exists = var:current_dragon
				has_trait = lifestyle_blademaster
			}
		}	
	}
	send_option = {
		flag = mage_hunter_dragon_trainer
		localization = mage_hunter_dragon_trainer
		is_shown = {
			scope:recipient = {
				exists = var:current_dragon
				has_trait = lifestyle_hunter
			}
		}	
	}
	send_option = {
		flag = mage_mystic_dragon_trainer
		localization = mage_mystic_dragon_trainer
		is_shown = {
			scope:recipient = {
				exists = var:current_dragon
				has_trait = lifestyle_mystic
			}
		}	
	}
	send_option = {
		flag = mage_physician_dragon_trainer
		localization = mage_physician_dragon_trainer
		is_shown = {
			scope:recipient = {
				exists = var:current_dragon
				has_trait = lifestyle_physician
			}
		}	
	}
	send_option = {
		flag = mage_herbalist_dragon_trainer
		localization = mage_herbalist_dragon_trainer
		is_shown = {
			scope:recipient = {
				exists = var:current_dragon
				has_trait = lifestyle_herbalist
			}
		}	
	}
	send_option = {
		flag = mage_gardener_dragon_trainer
		localization = mage_gardener_dragon_trainer
		is_shown = {
			scope:recipient = {
				exists = var:current_dragon
				has_trait = lifestyle_gardener
			}
		}	
	}
	send_option = {
		flag = mage_reveler_dragon_trainer
		localization = mage_reveler_dragon_trainer
		is_shown = {
			scope:recipient = {
				exists = var:current_dragon
				has_trait = lifestyle_reveler
			}
		}	
	}

	auto_accept = yes
	ai_targets = {
		ai_recipients = self
	}

	ai_frequency = 12

	ai_will_do = {
		base = 100
	}
}

zz_valyria_take_nickname_action = {
	is_shown = {
		scope:actor = {
			is_ai = no
			has_character_flag = dragon_training
		}
	}
	is_valid_showing_failures_only = {
		scope:actor = {
			has_trait = zz_magister
		}
	}
	icon = icon_magic
	common_interaction = no
	interface_priority = 900
	category = interaction_secrets_of_valyria

	cooldown_against_recipient = { days = 0 } 
	cooldown = { days = 30 } 
	ignores_pending_interaction_block = yes
	use_diplomatic_range = yes
	#hidden = yes
	
	on_accept = {
		scope:recipient = {
			if = {
				limit = {
					scope:zz_nick_the_necromancer = yes
				}
				give_nickname = nick_the_necromancer
			}
			else_if = { 
				limit = { 
					scope:zz_nick_the_mage = yes 
				}
				scope:recipient = {
					give_nickname = nick_the_mage
				}
			}
			else_if = { 
				limit = { 
					scope:zz_nick_the_warlock = yes 
				}
				scope:recipient = {
					if  = { 
						limit = {
							is_female = yes 
						}
						give_nickname = nick_the_witch
					}
					else = {
						give_nickname = nick_the_warlock
					}
				}
			}
			else_if = { 
				limit = { 
					scope:zz_nick_the_seer = yes 
				}
				scope:recipient = {
					give_nickname = nick_the_seer
				}
			}
			else_if = { 
				limit = { 
					scope:zz_nick_the_dreamer = yes 
				}
				scope:recipient = {
					give_nickname = nick_the_dreamer
				}
			}
			else_if = { 
				limit = { 
					scope:zz_nick_the_poet = yes 
				}
				scope:recipient = {
					give_nickname = nick_the_poet
				}
			}
			else_if = { 
				limit = { 
					scope:zz_nick_the_bard = yes 
				}
				scope:recipient = {
					give_nickname = nick_the_bard
				}
			}
			else_if = { 
				limit = { 
					scope:zz_nick_the_singer = yes 
				}
				scope:recipient = {
					give_nickname = nick_the_singer
				}
			}
			else_if = { 
				limit = { 
					scope:zz_nick_the_dragonknight = yes 
				}
				scope:recipient = {
					give_nickname = nick_the_dragonknight_historic
				}
			}
		}
	}
	send_options_exclusive = yes

	send_option = {
		flag = zz_nick_the_necromancer
		localization = nick_the_necromancer
		is_shown = {
			scope:recipient = {
				NOT = {
					has_nickname = nick_the_necromancer
				}
			}
		}	
	}
	send_option = {
		flag = zz_nick_the_mage
		localization = nick_the_mage
		is_shown = {
			scope:recipient = {
				NOT = {
					has_nickname = nick_the_mage
				}
			}
		}	
	}
	send_option = {
		flag = zz_nick_the_warlock
		localization = nick_the_warlock
		is_shown = {
			scope:recipient = {
				NOT = {
					has_nickname = nick_the_warlock
				}
			}
		}	
	}
	send_option = {
		flag = zz_nick_the_seer
		localization = nick_the_seer
		is_shown = {
			scope:recipient = {
				NOT = {
					has_nickname = nick_the_seer
				}
			}
		}	
	}
	send_option = {
		flag = zz_nick_the_dreamer
		localization = nick_the_dreamer
		is_shown = {
			scope:recipient = {
				NOT = {
					has_nickname = nick_the_dreamer
				}
			}
		}	
	}
	send_option = {
		flag = zz_nick_the_poet
		localization = nick_the_poet
		is_shown = {
			scope:recipient = {
				NOT = {
					has_nickname = nick_the_poet
				}
			}
		}	
	}
	send_option = {
		flag = zz_nick_the_bard
		localization = nick_the_bard
		is_shown = {
			scope:recipient = {
				NOT = {
					has_nickname = nick_the_bard
				}
			}
		}	
	}
	send_option = {
		flag = zz_nick_the_singer
		localization = nick_the_singer
		is_shown = {
			scope:recipient = {
				NOT = {
					has_nickname = nick_the_singer
				}
			}
		}	
	}
	send_option = {
		flag = zz_nick_the_dragonknight
		localization = nick_the_dragonknight
		is_shown = {
			scope:recipient = {
				NOT = {
					has_nickname = nick_the_dragonknight
				}
			}
		}	
	}


	auto_accept = yes
	ai_targets = {
		ai_recipients = self
	}

	ai_frequency = 12

	ai_will_do = {
		base = 100
	}
}

zz_valyria_take_nickname_action = {
	is_shown = {
		scope:actor = {
			is_ai = no
			has_character_flag = dragon_training
		}
	}
	is_valid_showing_failures_only = {
		scope:actor = {
			has_trait = zz_magister
		}
	}
	icon = icon_magic
	common_interaction = no
	interface_priority = 900
	category = interaction_secrets_of_valyria

	cooldown_against_recipient = { days = 0 } 
	cooldown = { days = 30 } 
	ignores_pending_interaction_block = yes
	use_diplomatic_range = yes
	#hidden = yes
	
	on_accept = {
		scope:recipient = {
			if = {
				limit = {
					scope:zz_generalist_school = yes
				}
				set_variable = {name = current_school_of_magic value = flag:generalist_magic}
			}
			else_if = { 
				limit = { 
					scope:zz_blood_school = yes 
				}
				scope:recipient = {
					set_variable = {name = current_school_of_magic value = flag:blood_magic}
				}
			}
			else_if = { 
				limit = { 
					scope:zz_shadow_school = yes 
				}
				scope:recipient = {
					set_variable = {name = current_school_of_magic value = flag:shadow_magic}
				}
			}
			else_if = { 
				limit = { 
					scope:zz_dream_school = yes 
				}
				scope:recipient = {
					set_variable = {name = current_school_of_magic value = flag:dream_magic}
				}
			}
			else_if = { 
				limit = { 
					scope:zz_alchemy_school = yes 
				}
				scope:recipient = {
					set_variable = {name = current_school_of_magic value = flag:alchemy_magic}
				}
			}
			else_if = { 
				limit = { 
					scope:zz_fire_school = yes 
				}
				scope:recipient = {
					set_variable = {name = current_school_of_magic value = flag:fire_magic}
				}
			}
			else_if = { 
				limit = { 
					scope:zz_air_school = yes 
				}
				scope:recipient = {
					set_variable = {name = current_school_of_magic value = flag:air_magic }
				}

			}
			else_if = { 
				limit = { 
					scope:zz_water_school = yes 
				}
				scope:recipient = {
					set_variable = {name = current_school_of_magic value = flag:water_magic}
				}
			}
		}
	}
	send_options_exclusive = yes

	send_option = {
		flag = zz_generalist_school
		localization = zz_generalist_school
		is_shown = {
			scope:recipient = {
				NOT = {
					var:current_school_of_magic = flag:generalist_magic
				}
			}
		}	
	}
	send_option = {
		flag = zz_blood_school
		localization = zz_blood_school
		is_shown = {
			scope:recipient = {
				NOT = {
					var:current_school_of_magic = flag:blood_magic
				}
			}
		}	
	}
	send_option = {
		flag = zz_shadow_school
		localization = zz_shadow_school
		is_shown = {
			scope:recipient = {
				NOT = {
					var:current_school_of_magic = flag:shadow_magic
				}
			}
		}	
	}
	send_option = {
		flag = zz_dream_school
		localization = zz_dream_school
		is_shown = {
			scope:recipient = {
				NOT = {
					var:current_school_of_magic = flag:dream_magic
				}
			}
		}	
	}
	send_option = {
		flag = zz_alchemy_school
		localization = zz_alchemy_school
		is_shown = {
			scope:recipient = {
				NOT = {
					var:current_school_of_magic = flag:alchemy_magic
				}
			}
		}	
	}
	send_option = {
		flag = zz_fire_school
		localization = zz_fire_school
		is_shown = {
			scope:recipient = {
				NOT = {
					var:current_school_of_magic = flag:fire_magic
				}
			}
		}	
	}
	send_option = {
		flag = zz_air_school
		localization = zz_air_school
		is_shown = {
			scope:recipient = {
				NOT = {
					var:current_school_of_magic = flag:air_magic
				}
			}
		}	
	}
	send_option = {
		flag = zz_water_school
		localization = zz_water_school
		is_shown = {
			scope:recipient = {
				NOT = {
					var:current_school_of_magic = flag:water_magic
				}
			}
		}	
	}


	auto_accept = yes
	ai_targets = {
		ai_recipients = self
	}

	ai_frequency = 12

	ai_will_do = {
		base = 100
	}
}

