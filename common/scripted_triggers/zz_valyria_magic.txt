zz_valyria_has_mana_to_cast = { 
	OR = {
		has_character_modifier = zz_valyria_magic_drops_power
		AND = {
			has_trait = zz_magister
			has_trait_xp = {
				trait = zz_magister
				track = drops_of_power
				value >= $MANACOST$
			}
		}
	}
}

zz_valyria_can_gain_mana = {
	OR = {
		AND = {
			has_trait = zz_magister
			has_trait_xp = {
				trait = zz_magister
				track = drops_of_power
				value < 100
			}
		}
		NOR = {
			has_trait = zz_magister
			has_character_modifier = zz_valyria_magic_drops_power
		}
	}
}

zz_valyria_knows_spell = {
	OR = { 
		has_character_flag = $SPELL$
		#has_perk = $SPELL$
	}
}

zz_valyria_knows_spell_court = {
	OR = { 
		zz_valyria_knows_spell = {
			SPELL = $SPELL$
		}
		any_courtier_or_guest = { 
			zz_valyria_knows_spell = {
				SPELL = $SPELL$
			}
		}
		any_child = { 
			zz_valyria_knows_spell = {
				SPELL = $SPELL$
			}
		}
	}
}

zz_valyria_valid_caster = {
	zz_valyria_knows_spell = {
		SPELL = $SPELL$
	}
	zz_valyria_has_mana_to_cast = {
		MANACOST = $MANACOST$
	}
	custom_description = {
		text = is_incapable_custom
		NOT = { has_trait = incapable }
	}
	custom_description = {
		text = not_in_army_0
		is_in_army = no
	}
	custom_description = {
		text = not_in_travel_0
		OR = {
			location = capital_province
			#is_at_home = yes
			AND = {
				exists = involved_activity
				NOT = {
					has_activity_state = travel
				}
			}
			AND = {
				exists = current_travel_plan
				current_travel_plan = {
					any_entourage_character = {
						this = scope:recipient
					}
				}
			}
			AND = {
				exists = liege
				location = liege.location
				location = scope:recipient.location
				liege.location = liege.capital_province
			}
		}
	}	
}

zz_valyria_valid_caster_court = {
	OR = { 
		zz_valyria_valid_caster = {
			SPELL = $SPELL$
			MANACOST = $MANACOST$
		}
		any_courtier_or_guest = { 
			zz_valyria_valid_caster = {
				SPELL = $SPELL$
				MANACOST = $MANACOST$
			}
		}
		any_child = { 
			zz_valyria_valid_caster = {
				SPELL = $SPELL$
				MANACOST = $MANACOST$
			}
		}
	}
}