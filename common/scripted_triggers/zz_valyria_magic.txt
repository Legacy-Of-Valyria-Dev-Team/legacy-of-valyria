zz_valyria_magic_sites = {
	OR = {
		barony = title:b_kastaryia_4
		barony = title:b_kastaryia_3
		barony = title:b_kastaryia_2
		barony = title:b_kastaryia_1
		barony = title:b_valyria_5
		barony = title:b_jarqanor_1
		barony = title:b_aquos_dhaen_2
		barony = title:b_iedradrys_2
		barony = title:b_the_citadel
		barony = title:b_dragonstone
		barony = title:b_winterfell
		barony = title:b_oldstones
	}
}

zz_valyria_doom_sites = { 
	OR = {
		barony = title:b_ilvonys_1
		barony = title:b_dragonfields_1
		barony = title:b_kastaryia_4
		barony = title:b_valyria_5
		barony = title:b_jarqanor_1
		barony = title:b_ruklonos_1
		barony = title:b_hills_of_nolos_1
	}
}

zz_valyria_blackstone_sites = { 
	OR = {
		barony = title:b_pyrys_1
		barony = title:b_aquos_dhaen_1
		barony = title:b_kastaryia_3
		barony = title:b_valyria_1
		barony = title:b_gelios_1
		barony = title:b_iedradrys_1
		barony = title:b_oros_1
	}
}

zz_valyria_has_artifact = {

}

zz_valyria_has_mana_to_cast = { 
	OR = {
		has_character_modifier = zz_valyria_magic_drops_power
		AND = {
			has_trait = born_under_a_red_comet
			has_trait_xp = {
				trait = born_under_a_red_comet
				track = stores_of_power_04
				value >= $MANACOST$
			}
		}
		AND = {
			has_trait = born_under_a_red_comet
			has_trait_xp = {
				trait = born_under_a_red_comet
				track = stores_of_power_03
				value >= $MANACOST$
			}
		}
		AND = {
			has_trait = born_under_a_red_comet
			has_trait_xp = {
				trait = born_under_a_red_comet
				track = stores_of_power_02
				value >= $MANACOST$
			}
		}
		AND = {
			has_trait = born_under_a_red_comet
			has_trait_xp = {
				trait = born_under_a_red_comet
				track = stores_of_power_01
				value >= $MANACOST$
			}
		}
		AND = {
			has_trait = zz_magister
			has_trait_xp = {
				trait = zz_magister
				track = drops_of_power
				value >= $MANACOST$
			}
		}
	}
}

zz_valyria_can_gain_mana = {
	OR = {
		AND = {
			has_trait = zz_magister
			has_trait_xp = {
				trait = zz_magister
				track = drops_of_power
				value < 100
			}
		}
		AND = {
			has_trait = zz_magister
			has_trait = born_under_a_red_comet
			has_trait_xp = {
				trait = born_under_a_red_comet
				track = stores_of_power_01
				value < 100
			}
		}
		AND = {
			has_trait = zz_magister
			has_trait = born_under_a_red_comet
			has_trait_xp = {
				trait = born_under_a_red_comet
				track = stores_of_power_02
				value < 100
			}
		}
		AND = {
			has_trait = zz_magister
			has_trait = born_under_a_red_comet
			has_trait_xp = {
				trait = born_under_a_red_comet
				track = stores_of_power_03
				value < 100
			}
		}
		AND = {
			has_trait = zz_magister
			has_trait = born_under_a_red_comet
			has_trait_xp = {
				trait = born_under_a_red_comet
				track = stores_of_power_04
				value < 100
			}
		}
		NAND = {
			has_trait = zz_magister
			has_character_modifier = zz_valyria_magic_drops_power
		}
	}
}

zz_valyria_is_mage_activities = {
	OR = { 
		has_trait = zz_magister
		any_living_mage = {
			liege_or_court_owner ?= PREV 
		}
	}
}

zz_valyria_is_mage = {
	OR = { 
		has_trait = zz_magister
		any_living_mage = {
			liege_or_court_owner ?= scope:actor 
		}
	}
}
zz_valyria_is_mage_can_teach = {
	OR = { 
		AND = {
			has_trait = zz_magister
			NOT = { 
				has_character_flag = zz_valyria_magic_taught_magic 
			}
		}
		any_living_mage = {
			AND = {
				liege_or_court_owner ?= scope:actor 
				NOT = { 
					has_character_flag = zz_valyria_magic_taught_magic 
				}
			}
		}
	}
}


zz_valyria_knows_spell = {
	OR = { 
		any_memory = {
			has_memory_type ?= $SPELL$
		}		
		any_artifact = { 
			is_equipped = yes
			has_variable ?= $SPELL$_flag 
		}
	}
}

zz_valyria_knows_spell_court = {
	OR = { 
		zz_valyria_knows_spell = {
			SPELL = $SPELL$
		}
		any_living_mage = {
			liege_or_court_owner ?= scope:actor 
			zz_valyria_knows_spell = {
				SPELL = $SPELL$
			}
		}
	}
}


zz_valyria_valid_caster = {
	zz_valyria_knows_spell = {
		SPELL = $SPELL$
	}
	zz_valyria_has_mana_to_cast = {
		MANACOST = $MANACOST$
	}
	is_incapable = no 
}

zz_valyria_valid_caster_court = {
	OR = { 
		zz_valyria_valid_caster = {
			SPELL = $SPELL$
			MANACOST = $MANACOST$
		}
		any_living_mage = {
			liege_or_court_owner ?= scope:actor 
			zz_valyria_valid_caster = {
				SPELL = $SPELL$
				MANACOST = $MANACOST$
			}
		}
	}
}

zz_valyria_learn_spell_gui_trigger = {
	trigger_if  = { 
		limit  = {
			scope:zz_valyria_mystery = {
				has_memory_type = $SPELL$
			}
		}
		var:zz_magic_learner = { 
			NOT = {
				zz_valyria_knows_spell = {
					SPELL = $SPELL$
				}
			}
		}
	}
}