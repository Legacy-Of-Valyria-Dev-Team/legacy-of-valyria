on_game_start = {
	on_actions = {
		zz_valyria_magic_grant_spells
	}
}




quarterly_playable_pulse = {
	on_actions = {
		zz_valyria_magic_grant_spells
		zz_valyria_mana_gain_on_action
	}
}

zz_valyria_mana_gain_on_action = {
	trigger = {
		has_trait = zz_magister
	}
	effect = {
		if = {
			limit = {
				NOT = {
					has_trait = born_under_a_red_comet
				}
			}
			zz_valyria_mana_gain = {
				MANAGAIN = 1
			}
		}
		else_if = {
			limit = {
				has_trait = born_under_a_red_comet
				has_trait_xp = {
					trait = chosen_of_the_heavens
					track = drops_of_power
					value < 25
				}
			}
			zz_valyria_mana_gain = {
				MANAGAIN = 3
			}
		}
		else_if = {
			limit = {
				has_trait = born_under_a_red_comet
				has_trait_xp = {
					trait = chosen_of_the_heavens
					track = drops_of_power
					value < 50
				}
			}
			zz_valyria_mana_gain = {
				MANAGAIN = 5
			}
		}
		else_if = {
			limit = {
				has_trait = born_under_a_red_comet
				has_trait_xp = {
					trait = chosen_of_the_heavens
					track = drops_of_power
					value < 75
				}
			}
			zz_valyria_mana_gain = {
				MANAGAIN = 7
			}
		}
		else_if = {
			limit = {
				has_trait = born_under_a_red_comet
				has_trait_xp = {
					trait = chosen_of_the_heavens
					track = drops_of_power
					value < 100
				}
			}
			zz_valyria_mana_gain = {
				MANAGAIN = 100
			}
		}
	}
}

zz_valyria_magic_grant_spells = {
	trigger = {
		has_trait = zz_magister
	}
	effect = {
		add_character_flag = dragon_training

		add_character_flag = healing_spell_flag
		add_character_flag = development_boost_spell_flag
		add_character_flag = building_speed_spell_flag
		add_character_flag = genetic_manipulation_spell_flag
		add_character_flag = dreams_of_experience_spell_flag
		add_character_flag = transmutation_spell_flag
		add_character_flag = secrets_of_dreams_spell_flag
		add_character_flag = building_speed_spell_flag
		add_character_flag = empowerment_of_arms_spell_flag
		add_character_flag = dreaming_within_spell_flag
	}
}



on_building_completed = {
	trigger = {
		OR = { 
			has_building_with_flag = { flag = travel_point_of_interest_magic }
			root.capital_barony = {
				this = title:b_valyria_5
			}
		}
		NOT = { has_travel_point_of_interest = travel_point_of_interest_magic }
	}
	effect = { 
		add_travel_point_of_interest = travel_point_of_interest_magic
	}
}