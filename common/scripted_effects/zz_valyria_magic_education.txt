resolve_magic_education_success_reward_effect = {
	involved_activity ?= {
		#Perfect studies - 75-100
		if = {
			limit = { var:activity_special_type_progression >= 75 }
			scope:host = {
				add_character_flag = perfect_studies_reward
			}
		}
		#High-end studies - 50-75
		else_if = {
			limit = { 
				var:activity_special_type_progression < 75
				var:activity_special_type_progression >= 50
			} 
			scope:host = {
				add_character_flag = high_studies_reward
			}
		}
		#OK studies - 25-50
		else_if = {
			limit = {
				var:activity_special_type_progression < 50
				var:activity_special_type_progression >= 25
			}
			scope:host = {
				add_character_flag = mid_studies_reward
			}
		}
		#Lousy studies - 0-25
		else = {
			scope:host = {
				add_character_flag = low_studies_reward
			}
		}
	}
}



magic_education_completed_log_entry_effect = {
	involved_activity = {
		add_activity_log_entry = {
			key = magic_education_studies_completed_log
			tags = { completed }
			score = 100
			show_in_conclusion = yes
			character = root
			#Effects
			root = {
				disburse_magic_education_reward_effect = yes
			}
		}
	}
}



disburse_magic_education_reward_effect = {

	switch = { # Hand out lifestyle perks/xp
		trigger = has_character_flag
		perfect_studies_reward = {
			zz_random_gain_magic_spell = yes
			zz_random_gain_magic_spell = yes
			zz_random_gain_magic_spell = yes
			zz_random_gain_magic_spell = yes
			zz_random_gain_magic_spell = yes
			random = {
				chance = 60
				if = { 
					limit = { 
						has_trait = born_under_a_red_comet
					}
					add_trait_xp = { 
						trait = born_under_a_red_comet
						track = chosen_of_the_heavens
						value = 5
					}
				}
				else = { 
					add_trait_force_tooltip = born_under_a_red_comet
				}
				
			}
			remove_character_flag = perfect_studies_reward
		}
		high_studies_reward = {
			zz_random_gain_magic_spell = yes
			zz_random_gain_magic_spell = yes
			zz_random_gain_magic_spell = yes

			remove_character_flag = high_studies_reward
		}
		mid_studies_reward = {
			zz_random_gain_magic_spell = yes
			zz_random_gain_magic_spell = yes

			remove_character_flag = mid_studies_reward
		}
		low_studies_reward = {
			zz_random_gain_magic_spell = yes

			remove_character_flag = low_studies_reward
		}
	}
	# Options rewards
	if = {
		limit = {
			scope:activity = {
				has_activity_option = {
					category = adult_education_option_books
					option = adult_education_books_good
				}
			}
			has_dlc_feature = royal_court
			scope:host = { has_royal_court = yes }
		}
		custom_tooltip = adult_education_books_good_reward
		hidden_effect = {
			random_dummy_gender_effect = yes
			create_artifact_book_effect = {
				OWNER = scope:host
				CREATOR = scope:dummy_gender
				SET_SUBJECT = flag:no
				SET_TOPIC = flag:no
			}
			hidden_effect_new_object = {
				scope:newly_created_artifact = {
					set_artifact_rarity = illustrious
				}
			}
			scope:activity = {
				add_to_variable_list = {
					name = artifact_rewards
					target = scope:newly_created_artifact
				}
			}
		}
	}
	else_if = {
		limit = {
			scope:activity = {
				has_activity_option = {
					category = adult_education_option_books
					option = adult_education_books_good
				}
			}
		}
		custom_tooltip = adult_education_books_good_reward
		hidden_effect = {
			save_temporary_scope_value_as = {
				name = should_be_trinket
				value = yes
			}
			random_dummy_gender_effect = yes
			save_scope_value_as = {
				name = quality
				value = 50
			}
			save_scope_value_as = {
				name = wealth
				value = 50
			}
			create_artifact_book_effect = {
				OWNER = scope:host
				CREATOR = scope:dummy_gender
				SET_SUBJECT = flag:no
				SET_TOPIC = flag:no
			}
			hidden_effect_new_object = {
				scope:newly_created_artifact = {
					set_artifact_rarity = illustrious
				}
			}
			scope:activity = {
				add_to_variable_list = {
					name = artifact_rewards
					target = scope:newly_created_artifact
				}
			}
		}
		if = {
			limit = {
				has_trait = education_diplomacy
			}
			add_diplomacy_skill = 1
		}
		else_if = {
			limit = {
				has_trait = education_martial
			}
			add_martial_skill = 1
		}
		else_if = {
			limit = {
				has_trait = education_stewardship
			}
			add_stewardship_skill = 1
		}
		else_if = {
			limit = {
				has_trait = education_intrigue
			}
			add_intrigue_skill = 1
		}
		else_if = {
			limit = {
				has_trait = education_learning
			}
			add_learning_skill = 1
		}
	}
	else_if = {
		limit = {
			scope:activity = {
				has_activity_option = {
					category = adult_education_option_books
					option = adult_education_books_normal
				}
			}
		}
		if = {
			limit = {
				has_trait = education_diplomacy
			}
			add_diplomacy_skill = 1
		}
		else_if = {
			limit = {
				has_trait = education_martial
			}
			add_martial_skill = 1
		}
		else_if = {
			limit = {
				has_trait = education_stewardship
			}
			add_stewardship_skill = 1
		}
		else_if = {
			limit = {
				has_trait = education_intrigue
			}
			add_intrigue_skill = 1
		}
		else_if = {
			limit = {
				has_trait = education_learning
			}
			add_learning_skill = 1
		}
	}
}
