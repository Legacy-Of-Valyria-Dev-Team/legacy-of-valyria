zz_valyria_settlement_learning_test = {

}
zz_valyria_settlement_diplomacy_test = {
	
}
zz_valyria_settlement_stewardship_test = {
	
}
zz_valyria_settlement_intrigue_test = {
	
}
zz_valyria_settlement_martial_test = {
	
}
zz_valyria_settlement_prowess_test = {
	
}

resolve_valyria_settlement_success_reward_effect = {
	scope:host = { 
		if = { 
			limit = { 
				has_activity_intent = settle_castle 
			}
			add_character_flag = settle_castle
		}
		if = { 
			limit = { 
				has_activity_intent = settle_city 
			}
			add_character_flag = settle_city
		}
		if = { 
			limit = { 
				has_activity_intent = settle_temple 
			}
			add_character_flag = settle_temple
		}
	}
	
	involved_activity ?= {
		
		#Perfect settlement - 75-100
		if = {
			limit = { var:activity_special_type_progression >= 75 }
			scope:host = {
				add_character_flag = perfect_settlement_reward
			}
		}
		#High-end settlement - 50-75
		else_if = {
			limit = { 
				var:activity_special_type_progression < 75
				var:activity_special_type_progression >= 50
			} 
			scope:host = {
				add_character_flag = high_settlement_reward
			}
		}
		#OK settlement - 25-50
		else_if = {
			limit = {
				var:activity_special_type_progression < 50
				var:activity_special_type_progression >= 25
			}
			scope:host = {
				add_character_flag = mid_settlement_reward
			}
		}
		#Lousy settlement - 0-25
		else = {
			scope:host = {
				add_character_flag = low_settlement_reward
			}
		}
	}
}



valyria_settlement_completed_log_entry_effect = {
	involved_activity = {
		add_activity_log_entry = {
			key = valyria_settlement_studies_completed_log
			tags = { completed }
			score = 100
			show_in_conclusion = yes
			character = root
			#Effects
			root = {
				disburse_valyria_settlement_reward_effect = yes
			}
		}
	}
}
disburse_valyria_settlement_reward_effect = {
	switch = { # Hand out lifestyle perks/xp
		trigger = has_character_flag
		perfect_settlement_reward = { 
			zz_valyria_settlement_effect = yes
		}
		high_settlement_reward = { 
			zz_valyria_settlement_effect = yes
		}
		mid_settlement_reward = { 
			zz_valyria_settlement_effect = yes			
		}
		low_settlement_reward = { 
			remove_character_flag = low_settlement_reward
		}
	}
}



zz_valyria_settlement_effect = { 
	scope:host = { 
		barony = { set_coa = this.holder.house }
		switch = {
			trigger = has_character_flag 
			settle_castle = { 
				scope:province = {
					set_holding_type = castle_holding	
				}
				switch = {
					trigger = has_character_flag
					perfect_settlement_reward = {
						scope:province = {
							add_building = castle_03
						}
						remove_character_flag = perfect_settlement_reward
					}
					high_settlement_reward = {
						scope:province = {
							add_building = castle_02
						}
						remove_character_flag = high_settlement_reward
					}
					mid_settlement_reward ={
						scope:province = {
							add_building = castle_01
						}
						remove_character_flag = mid_settlement_reward
					}
				}
				
				remove_character_flag = settle_castle
			}
			settle_city = { 
				scope:province  = {
					set_holding_type = city_holding
					
				}
				switch = {
					trigger = has_character_flag
					perfect_settlement_reward = {
						scope:province = {
							add_building = city_03
						}
						remove_character_flag = perfect_settlement_reward
					}
					high_settlement_reward = {
						scope:province = {
							add_building = city_02
						}
						remove_character_flag = high_settlement_reward
					}
					mid_settlement_reward ={
						scope:province = {
							add_building = city_01
						}
						remove_character_flag = mid_settlement_reward
					}
				}
				remove_character_flag = settle_city
			}
			settle_temple = { 
				scope:province = {
					set_holding_type = church_holding
				}
				switch = {
					trigger = has_character_flag
					perfect_settlement_reward = {
						scope:province = {
							add_building = temple_03
						}
						remove_character_flag = perfect_settlement_reward
					}
					high_settlement_reward = {
						scope:province = {
							add_building = temple_02
						}
						remove_character_flag = high_settlement_reward
					}
					mid_settlement_reward ={
						scope:province = {
							add_building = temple_01
						}
						remove_character_flag = mid_settlement_reward
					}
				}
				remove_character_flag = settle_temple
			}
		}
		if = {
			limit = { has_character_flag = large_settlement_development_gain }
			 scope:province = {
				 county = {
					 change_development_level = 10
				 }
			 }
		 }
		 else_if = {
			 limit = { has_character_flag = med_settlement_development_gain }
			 scope:province = {
				 county = {
					 change_development_level = 6
				 }
			 }
		 }
	}
}


zz_valyria_settlment_construct_secondary_buildings = {
	if = { 
		limit = {
			has_character_flag = learning_building_flag
		}
		remove_character_flag = learning_building_flag
	}
	if = { 
		limit = {
			has_character_flag = diplomacy_building_flag
		}
		remove_character_flag = diplomacy_building_flag
	}
	if = { 
		limit = {
			has_character_flag = stewardship_building_flag
		}
		remove_character_flag = stewardship_building_flag
	}
	if = { 
		limit = {
			has_character_flag = intrigue_building_flag
		}
		remove_character_flag = intrigue_building_flag
	}
	if = { 
		limit = {
			has_character_flag = martial_building_flag
		}
		remove_character_flag = martial_building_flag
	}
	if = { 
		limit = {
			has_character_flag = prowess_building_flag
		}
		remove_character_flag = prowess_building_flag
	}
}

