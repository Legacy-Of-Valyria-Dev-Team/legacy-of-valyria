set_up_domicile_estate_effect = {
	if = {
		limit = { is_domicile_type = estate }
		# Intentionally one level lower than what you can get
		if = {
			limit = {
				NOT = { has_domicile_building_or_higher = estate_main_02 }
				owner.culture ?= { has_innovation = innovation_city_planning }
			}
			add_domicile_building = estate_main_02
		}
		if = {
			limit = {
				has_domicile_building = estate_main_02
				NOT = { has_domicile_building_or_higher = estate_main_03 }
				owner.culture ?= { has_innovation = innovation_manorialism }
			}
			add_domicile_building = estate_main_03
		}
		switch = {
			trigger = has_domicile_building
			estate_main_03 = {
				while = {
					count = 2
					add_random_internal_estate_building = yes
				}
			}
			estate_main_02 = {
				add_random_internal_estate_building = yes
			}
		}
		fill_external_estate_building_effect = yes
	}
	else_if = {
		limit = { is_domicile_type = dragonkeep }
		if = {
			limit = {
				NOT = { has_domicile_building_or_higher = dragonkeep_main_02 }
				owner.culture ?= { has_innovation = innovation_city_planning }
			}
			add_domicile_building = dragonkeep_main_02
		}
		if = {
			limit = {
				has_domicile_building = dragonkeep_main_02
				NOT = { has_domicile_building_or_higher = dragonkeep_main_03 }
				owner.culture ?= { has_innovation = innovation_manorialism }
			}
			add_domicile_building = dragonkeep_main_03
		}
		switch = {
			trigger = has_domicile_building
			dragonkeep_main_03 = {
				while = {
					count = 2
					add_random_internal_estate_building = yes
				}
			}
			dragonkeep_main_03 = {
				add_random_internal_estate_building = yes
			}
		}
		fill_external_dragonkeep_building_effect = yes
	}
}




fill_external_dragonkeep_building_effect = {
	switch = {
		trigger = has_domicile_building_or_higher
		dragonkeep_main_05 = {
			while = {
				limit = { free_external_domicile_building_slots >= 1 }
				add_random_external_dragonkeep_building = yes
			}
		}
		dragonkeep_main_04 = {
			while = {
				limit = { free_external_domicile_building_slots >= 2 }
				add_random_external_dragonkeep_building = yes
			}
		}
		dragonkeep_main_03 = {
			while = {
				limit = { free_external_domicile_building_slots >= 3 }
				add_random_external_dragonkeep_building = yes
			}
		}
		dragonkeep_main_02 = {
			while = {
				limit = { free_external_domicile_building_slots >= 4 }
				add_random_external_dragonkeep_building = yes
			}
		}
		dragonkeep_main_01 = {
			while = {
				limit = { free_external_domicile_building_slots >= 5 }
				add_random_external_dragonkeep_building = yes
			}
		}
	}
}

add_random_external_dragonkeep_building = {
	if = {
		limit = {
			free_external_domicile_building_slots >= 1
		}
		random_list = {
			10 = {
				trigger = {
					NOT = { has_domicile_building_or_higher = dragonkeep_temple_small_01 }
				}
				add_domicile_building = dragonkeep_temple_small_01
				if = {
					limit = { has_domicile_building = dragonkeep_main_03 }
					add_domicile_building = dragonkeep_temple_small_02
				}
			}
			10 = {
				trigger = {
					NOT = { has_domicile_building_or_higher = dragonkeep_barracks_01 }
				}
				add_domicile_building = dragonkeep_barracks_01
				if = {
					limit = { has_domicile_building = dragonkeep_main_03 }
					add_domicile_building = dragonkeep_barracks_02
				}
			}
			10 = {
				trigger = {
					NOT = { has_domicile_building_or_higher = dragonkeep_watchtower_01 }
				}
				add_domicile_building = dragonkeep_watchtower_01
				if = {
					limit = { has_domicile_building = dragonkeep_main_03 }
					add_domicile_building = dragonkeep_watchtower_02
				}
			}
			10 = {
				trigger = {
					NOT = { has_domicile_building_or_higher = dragonkeep_vineyard_01 }
				}
				add_domicile_building = dragonkeep_vineyard_01
				if = {
					limit = { has_domicile_building = dragonkeep_main_03 }
					add_domicile_building = dragonkeep_vineyard_02
				}
			}
			10 = {
				trigger = {
					NOT = { has_domicile_building_or_higher = dragonkeep_guardhouse_01 }
				}
				add_domicile_building = dragonkeep_guardhouse_01
				if = {
					limit = { has_domicile_building = dragonkeep_main_03 }
					add_domicile_building = dragonkeep_guardhouse_02
				}
			}
			10 = {
				trigger = {
					NOT = { has_domicile_building_or_higher = dragonkeep_garden_01 }
				}
				add_domicile_building = dragonkeep_garden_01
				if = {
					limit = { has_domicile_building = dragonkeep_main_03 }
					add_domicile_building = dragonkeep_garden_02
				}
			}
			10 = {
				trigger = {
					NOT = { has_domicile_building_or_higher = dragonkeep_storage_01 }
				}
				add_domicile_building = dragonkeep_storage_01
				if = {
					limit = { has_domicile_building = dragonkeep_main_03 }
					add_domicile_building = dragonkeep_storage_02
				}
			}
			10 = {
				trigger = {
					NOT = { has_domicile_building_or_higher = dragonkeep_grain_field_01 }
				}
				add_domicile_building = dragonkeep_grain_field_01
				if = {
					limit = { has_domicile_building = dragonkeep_main_03 }
					add_domicile_building = dragonkeep_grain_field_02
				}
			}
			10 = {
				trigger = {
					NOT = { has_domicile_building_or_higher = dragonkeep_stable_01 }
				}
				add_domicile_building = dragonkeep_stable_01
				if = {
					limit = { has_domicile_building = dragonkeep_main_03 }
					add_domicile_building = dragonkeep_stable_02
				}
			}
			10 = {
				trigger = {
					NOT = { has_domicile_building_or_higher = dragonkeep_workshop_01 }
				}
				add_domicile_building = dragonkeep_workshop_01
				if = {
					limit = { has_domicile_building = dragonkeep_main_03 }
					add_domicile_building = dragonkeep_workshop_02
				}
			}
			10 = {
				trigger = {
					NOT = { has_domicile_building_or_higher = dragonkeep_market_01 }
				}
				add_domicile_building = dragonkeep_market_01
				if = {
					limit = { has_domicile_building = dragonkeep_main_03 }
					add_domicile_building = dragonkeep_market_02
				}
			}
			10 = {
				trigger = {
					NOT = { has_domicile_building_or_higher = dragonkeep_grazing_land_01 }
				}
				add_domicile_building = dragonkeep_grazing_land_01
				if = {
					limit = { has_domicile_building = dragonkeep_main_03 }
					add_domicile_building = dragonkeep_grazing_land_02
				}
			}
			10 = {
				trigger = {
					NOT = { has_domicile_building_or_higher = dragonkeep_olive_01 }
				}
				add_domicile_building = dragonkeep_olive_01
				if = {
					limit = { has_domicile_building = dragonkeep_main_03 }
					add_domicile_building = dragonkeep_olive_02
				}
			}
		}
	}
}