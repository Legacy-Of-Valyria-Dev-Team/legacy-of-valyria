# Legacy of Valyria general scripted effects

# For distributing owned inconsequential titles on game start or when necessary
# - Requires character scope
lv_distribute_titles_effect = {
	if = {
		limit = {
			always = $GRANT_DUCHY$
			NOT = { exists = $DUCHY$.holder }
		}
		get_title = $DUCHY$
	}
	if = {
		limit = { always = $GRANT_INDEPENDENCE$ }
		create_title_and_vassal_change = {
			type = independency
			save_scope_as = change
			add_claim_on_loss = yes
		}
	}
	else = {
		create_title_and_vassal_change = {
			type = granted
			save_scope_as = change
			add_claim_on_loss = no
		}
	}
	every_held_title = {
		limit = {
			tier = tier_county
			trigger_if = {
				limit = { NOT = { always = $GIVE_COUNTY_CAPITAL$ } }
				NOR = {
					this = $COUNTY_OF_HOLDER$
					trigger_if = { # Exception for Volantis
						limit = { $DUCHY$ = title:d_volantis }
						this = title:c_volantis
					}
				}
			}
			duchy = $DUCHY$
		}
		create_character = {
			location = this.title_province
			culture = scope:ruler.culture
			faith = scope:ruler.faith
			gender = male
			gender_female_chance = 50
			save_scope_as = vassal
		}
		change_title_holder_include_vassals = {
			holder = scope:vassal
			change = scope:change
		}
		if = {
			limit = { NOT = { always = $GRANT_INDEPENDENCE$ } }
			scope:vassal = {
				change_liege = {
					liege = scope:ruler
					change = scope:change
				}
			}
		}
		else = { scope:vassal = { becomes_independent = { change = scope:change } } }
	}
	resolve_title_and_vassal_change = scope:change
}