zz_valyria_mana_gain = {
	if = {
		limit = {
			has_trait = zz_magister
			has_trait_xp = {
				trait = zz_magister
				track = drops_of_power
				value < 100
			}
		}
		add_trait_xp = {
			trait = zz_magister
			track = drops_of_power
			value = $MANAGAIN$
		}
	}
	else_if = {
		limit = {
			NOR = {
				has_character_modifier = zz_valyria_magic_drops_power
			}
		}
		add_character_modifier = zz_valyria_magic_drops_power
	}
}

zz_valyria_mana_spend = {
	if = {
		limit = {
			OR = {
				has_character_modifier = zz_valyria_magic_drops_power
			}
		}
		remove_character_modifier = zz_valyria_magic_drops_power
	}
	else_if  = { 
		limit =  { 
			has_trait = zz_magister 
			has_trait_xp = {
				trait = zz_magister
				track = drops_of_power
				value > $MANACOST$
			}
		}
		hidden_effect = {
			add_trait_xp = {
				trait = zz_magister
				track = drops_of_power
				value = $MANASPEND$
			}
		}
	}
}

zz_valyria_gain_spell_experience = { 
	add_trait_xp = { 
		trait = archmage 
		track = $XPTRACK$ 
		value = $XPGAIN$ 
	}
}

zz_valyria_populate_spell_caster_list = {
	if = { 
		limit = {
			zz_valyria_valid_caster = {
				SPELL = $SPELL$
				MANACOST = $MANACOST$
			}
		}
		add_to_list = characters
	}
	every_courtier = {
		limit = {
			zz_valyria_valid_caster = {
				SPELL = $SPELL$
				MANACOST = $MANACOST$
			}
		}
		add_to_list = characters
	}
	every_child = {
		limit = {
			NOT = { is_in_list = characters }
			OR = {
				has_character_flag = $SPELL$
				has_perk =  $SPELL$
			}
			zz_valyria_has_mana_to_cast = { 
				MANACOST = $MANACOST$
			}
		}
		add_to_list = characters
	}
}