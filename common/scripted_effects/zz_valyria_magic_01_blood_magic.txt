zz_valyria_heal_effect = { 
	send_interface_message = {
		type = event_generic_neutral
		title = magic_healing
		desc = magic_healing_text
		left_icon = scope:actor
		right_icon = scope:recipient
		custom_tooltip = magic_healing_text
		if = {
			limit = {
				NOT = {
					scope:actor = scope:recipient
				}
			}
			scope:actor = {
				stress_impact = {
					compassionate = medium_stress_impact_loss
					sadistic = minor_stress_gain
					callous = minor_stress_gain
				}
			}
		}
		scope:recipient = {		
			if = { 
				limit = {
					scope:secondary_actor = { 
						has_trait = zz_magister
						has_trait_xp = {
							trait = zz_magister
							track = blood_magic 
							value >= 100
						}
					}
				}
				add_character_modifier = {
					modifier = zz_valyria_magic_life_span_boost_modifier 
					years = -1
				}
			}
			if = { 
				limit = {
					scope:secondary_actor = { 
						has_trait = zz_magister
						has_trait_xp = {
							trait = zz_magister
							track = blood_magic 
							value >= 75
						}
					}
				}
				add_character_modifier = {
					modifier = zz_valyria_magic_fertility_boost_modifier 
					years = -1
				}
			}
			if = { 
				limit = {
					scope:secondary_actor = { 
						has_trait = zz_magister
						has_trait_xp = {
							trait = zz_magister
							track = blood_magic 
							value >= 50
						}
					}
				}
				add_character_modifier = {
					modifier = zz_valyria_magic_disease_resistance_boost_modifier 
					years = 10
				}
			}
			if = { 
				limit = {
					scope:secondary_actor = { 
						has_trait = zz_magister
						has_trait_xp = {
							trait = zz_magister
							track = blood_magic 
							value >= 25
						}
					}
				}
				add_character_modifier = {
					modifier = zz_valyria_magic_health_boost_modifier 
					years = 10
				}
			}
			if = { limit = { has_trait = ill }
				remove_trait = ill
			}
			if = { limit = { has_trait = sickly }
				remove_trait = sickly
			}
			if = { limit = { has_trait = disfigured }
				remove_trait = disfigured
			}
			if = { limit = { has_trait = inbred }
				remove_trait = inbred
			}
			if = { limit = { has_trait = impotent }
				remove_trait = impotent
			}
			if = { limit = { has_trait = bleeder }
				remove_trait = bleeder
			}
			if = { limit = { has_trait = wheezing }
				remove_trait = wheezing
			}
			if = { limit = { has_trait = infertile }
				remove_trait = infertile
			}
			if = { limit = { has_trait = one_legged }
				remove_trait = one_legged
			}
			if = { limit = { has_trait = one_eyed }
				remove_trait = one_eyed
			}
			if = { limit = { has_trait = lunatic_genetic }
				remove_trait = lunatic_genetic
			}
			if = { limit = { has_trait = lunatic_1 }
				remove_trait = lunatic_1
			}
			if = { limit = { has_trait = pneumonic }
				remove_trait = pneumonic
			}
			if = { limit = { has_trait = great_pox }
				remove_trait = great_pox
			}
			if = { limit = { has_trait = early_great_pox }
				remove_trait = early_great_pox
			}
			if = { limit = { has_trait = lovers_pox }
				remove_trait = lovers_pox
			}
			if = { limit = { has_trait = leper }
				remove_trait = leper
			}
			if = { limit = { has_trait = wounded_1 }
				remove_trait = wounded_1
			}
			if = { limit = { has_trait = wounded_2 }
				remove_trait = wounded_2
			}
			if = { limit = { has_trait = wounded_3 }
				remove_trait = wounded_3
			}
			if = { limit = { has_trait = maimed }
				remove_trait = maimed
			}
			if = { limit = { has_trait = infirm }
				remove_trait = infirm
			}
			if = { limit = { has_trait = incapable }
				remove_trait = incapable
			}
			if = { limit = { has_trait = gout_ridden }
				remove_trait = gout_ridden
			}
			if = { limit = { has_trait = consumption }
				remove_trait = consumption
			}
			if = { limit = { has_trait = cancer }
				remove_trait = cancer
			}
			if = { limit = { has_trait = typhus }
				remove_trait = typhus
			}
			if = { limit = { has_trait = bubonic_plague }
				remove_trait = bubonic_plague
			}
			if = { limit = { has_trait = smallpox }
				remove_trait = smallpox
			}
			if = { limit = { has_trait = blind }
				remove_trait = blind
			}
			if = { limit = { has_character_modifier = chronic_headaches_modifier }
				remove_character_modifier = chronic_headaches_modifier
			}
			if = { limit = { has_character_modifier = infected_wound_modifier }
				remove_character_modifier = infected_wound_modifier
			}
			if = { limit = { has_character_modifier = gangrene_modifier }
				remove_character_modifier = gangrene_modifier
			}
			if = {	limit = {	has_trait = measles	}
				remove_trait = measles
			}
			if = {	limit = {	has_trait = dysentery	}
				remove_trait = dysentery
			}
			if = {	limit = {	has_trait = ergotism	}
				remove_trait = ergotism
			}
			if = {	limit = {	has_trait = scarred	}
				remove_trait = scarred
			}
			if = {
				limit = {
					NOT = { scope:actor = scope:recipient }
				}
				add_opinion = {
					modifier = grateful_opinion
					target = scope:actor
					opinion = 70
				}
			}
		}
	}	
}
zz_valyria_genetic_manipulation = {
	send_interface_message = {
		type = event_generic_neutral
		title = magic_genetic_manipulation
		desc = magic_genetic_manipulation_text
		left_icon = scope:actor
		right_icon = scope:recipient
		custom_tooltip = magic_genetic_manipulation_text
		if = {
			limit = {
				NOT = {
					scope:actor = scope:recipient
				}
			}
			stress_impact = {
				compassionate = medium_stress_impact_loss
				sadistic = minor_stress_gain
				callous = minor_stress_gain
			}
		}
		scope:recipient = {
			if = {
				limit = {
					scope:add_trait_intellect_good_3 = yes
				}
				scope:recipient = { 
					if = {
						limit = { 
							has_trait = intellect_bad 
						}
						change_trait_rank = {
							trait = intellect_bad
							rank = -1
						}
					}
					else = {
						if = {
							limit = {
								NOT = {
									has_trait = intellect_good
								}
							}
							add_trait_force_tooltip = intellect_good_1
						}
						else = {
							change_trait_rank = {
								trait = intellect_good
								rank = 1
							}
						}
					}
				} 
			}			
			else_if = {
				limit = {
					scope:add_trait_physique_good_3 = yes
				}
				scope:recipient = { 
					if = {
						limit = { 
							has_trait = physique_bad 
						}
						change_trait_rank = {
							trait = physique_bad
							rank = -1
						}
					}
					else = {
						if = {
							limit = {
								NOT = {
									has_trait = physique_good
								}
							}
							add_trait_force_tooltip = physique_good_1
						}
						else = {
							change_trait_rank = {
								trait = physique_good
								rank = 1
							}
						}
					}
				}
			}			
			else_if = {
				limit = {
					scope:add_trait_beauty_good_3 = yes
				}
				scope:recipient = { 
					if = {
						limit = { 
							has_trait = beauty_bad 
						}
						change_trait_rank = {
							trait = beauty_bad
							rank = -1
						}
					}
					else = {
						if = {
							limit = {
								NOT = {
									has_trait = beauty_good
								}
							}
							add_trait_force_tooltip = beauty_good_1
						}
						else = {
							change_trait_rank = {
								trait = beauty_good
								rank = 1
							}
						}
					}
				}
			}			
			else_if = {
				limit = {
					scope:remove_trait_infertile = yes
				}
				scope:recipient = { 
					remove_trait = infertile
				} 		
			}		
			if = {
				limit = {
					NOT = { scope:actor = scope:recipient }
				}
				add_opinion = {
					modifier = grateful_opinion
					target = scope:actor
					opinion = 70
					}
				}
		}
	}
}
zz_valyria_restore_maa = { 
	send_interface_message = {
		type = event_generic_neutral
		title = magic_restore_maa
		desc = magic_restore_maa_text
		left_icon = scope:actor
		right_icon = scope:recipient
		custom_tooltip = magic_restore_maa_text
		scope:target = {
			change_maa_troops_count = zz_blood_healing_scaling_value 
		}
	}
}
zz_valyria_renew_armies = { 
	send_interface_message = {
		type = event_generic_neutral
		title = magic_renew_armies
		desc = magic_renew_armies_text
		left_icon = scope:actor
		right_icon = scope:recipient
		custom_tooltip = magic_renew_armies_text
		scope:recipient = {
			commanding_army = { 
				every_army_maa_regiment = {
					change_maa_troops_count = zz_blood_healing_scaling_value 
				}
			}
		}
	}
}